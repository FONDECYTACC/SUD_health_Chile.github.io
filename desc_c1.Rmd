---
title: "Descriptive Analysis of C1"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide  
    toc: true # table of content true
    toc_depth: 5  # upto three depths of headings (specified by #, ## and ###)
    toc_float: true
---

<style type="text/css">
.tablelines table, .tablelines td, .tablelines th {
        border: 1px solid black;
        }
.centrado {
    text-align: center;
}
.table.center {
    margin-left:auto; 
    margin-right:auto;
  }
.table_wrapper{
    display: block;
    overflow-x: auto;
    white-space: nowrap;
}
code.r{
  font-size: 8px;
}
body{ /* Normal  */
      text-align: justify;
  }
.superbigimage{
    overflow-y:scroll;
    white-space: nowrap;
}
.superbigimage img{
    overflow-y: scroll;
    overflow-x: hidden;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(rsconnect.http.trace = TRUE)
options(rsconnect.http.verbose = TRUE)
options(rsconnect.launch.browser = FALSE)
getOption("rsconnect.max.bundle.size")
#Libraries used in the routine. Dont change the order
rm(list=ls());gc()
#rm(list=c("")
unlink('desc_c1_cache', recursive = TRUE)
load("G:/Mi unidad/Alvacast/SISTRAT 2019 (github)/5.Rdata")
local({r <- getOption("repos")
       r["CRAN"] <- "http://cran.r-project.org"
       options(repos=r)
})
#Libraries used in the routine. Dont change the order
if(!require(tidyr)){install.packages("tidyr")}
if(!require(DataExplorer)){install.packages("DataExplorer")}
if(!require(stringi)){install.packages("stringi")}
if(!require(stringr)){install.packages("stringr")}
if(!require(ggplot2)){install.packages("ggplot2")}
if(!require(Hmisc)){install.packages("Hmisc")}
if(!require(kableExtra)){install.packages("kableExtra")}
if(!require(plotly)){install.packages("plotly")}
if(!require(rbokeh)){install.packages("rbokeh")}
if(!require(altair)){install.packages("altair")}
if(!require(zoo)){install.packages("zoo")}
if(!require(broom)){install.packages("broom")}
if(!require(sqldf)){install.packages("sqldf")} 
if(!require(data.table)){install.packages("data.table")}
if(!require(dplyr)){install.packages("dplyr")}
if(!require(devtools)){install.packages("devtools")}
if(!require(Statamarkdown)){install_github("hemken/Statamarkdown", quiet=T,  upgrade="never")}
if(!require(ExPanDaR)){devtools::install_github("joachim-gassen/ExPanDaR", quiet=T,  upgrade="never")}
```

## Descriptive Analysis of C1

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r expandr para la gente, message=FALSE, warning=FALSE }
#ExPanD(df = CONS_C1_df_dup_FEB_2020, cs_id = "hash_key", ts_id = "fech_ing")
#options(rsconnect.http.trace = TRUE)
#options(rsconnect.http.verbose = TRUE)
#options(rsconnect.launch.browser = FALSE)
#getOption("rsconnect.max.bundle.size")
options(shiny.error = browser)

## Including Plots
#plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r image-map_chile_hosp, echo=T, fig.align='center', fig.pos='H', message=FALSE, warning=FALSE}

CONS_C1_df_dup_FEB_2020 %>%
  count(hash_key) %>%

#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_#_#_#_#_#__#_#_#_#_#_#_#_#_#_#_#_

library(ggplot2)
data(admin1.map, package="choroplethrAdmin1")
chile.map = admin1.map[admin1.map$admin == "chile" & admin1.map$long > -80, ]
#ggplot(chile.map, aes(long, lat, group=group)) + geom_polygon() + coord_map()

arica <- list(v = 6.08, n = "region de arica y parinacota")
tarapaca <- list(v = 6.02, n= "region de tarapaca")
antofagasta <- list(v = 6.24,n = "region de antofagasta")
atacama <- list(v = 6.66, n = "region de atacama")
coquimbo <- list(v = 6.93, n = "region de coquimbo")
valparaiso <- list(v = 7.19,n = "region de valparaiso")
metropolitana <- list(v = 6.33, n = "region metropolitana de santiago")
ohiggins <- list(v = 5.27, n = "region del libertador general bernardo o'higgins")
maule <- list(v = 5.99, n = "region del maule")
nuble <- list(v = 5.99, n = "region de ñuble")
biobio <- list(v = 8.07, n = "region del biobio")
araucania <- list(v = 6.07, n = "region de la araucania")
losrios <- list(v = 4.72, n = "region de los rios")
loslagos <- list(v = 3.82, n = "region de los lagos")
aysen <- list(v = 3.84, n = "region aisen del general carlos ibanez del campo")
magallanes <- list(v = 2.63, n = "region de magallanes y de la antartica chilena")

dat2 <- data.frame(
   region = c(arica$n,tarapaca$n,antofagasta$n,atacama$n,coquimbo$n,valparaiso$n,
            metropolitana$n,ohiggins$n,maule$n,nuble$n, biobio$n,araucania$n,losrios$n,
            loslagos$n,aysen$n,magallanes$n)
     )

dat2<-dat2 %>%
      cbind(value=as.numeric(minsal_casos_sin_hosp$`Casos Totales`)) %>%
            data.frame()

p <- admin1_choropleth(country.name = "chile", 
                       df           = dat2, 
                       title        = "Hospitalizaciones Según Región", 
                       legend       = "No. de casos")
#p+scale_x_continuous(limits=c(0, 152)) #Restringir a Chile continental

admin1_region_choropleth(df= dat2,
                         title        = "Hospitalizaciones Según Región", 
                         legend       = "No. de casos")
```



<!--- 
#CFR
#Faltan las fechas
#https://cran.r-project.org/web/packages/coarseDataTools/vignettes/CFR_vignette.pdf
#https://github.com/calthaus/ncov-cfr
#https://github.com/jriou/covid_adjusted_cfr
#https://www.r-bloggers.com/covid-19-cumulative-observed-case-fatality-rate-over-time-by-ellis2013nz/
--->


