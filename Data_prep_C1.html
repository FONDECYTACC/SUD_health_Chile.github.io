<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Preparation and Standardization</title>

<script src="Data_prep_C1_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Data_prep_C1_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Data_prep_C1_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Data_prep_C1_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Data_prep_C1_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Data_prep_C1_files/navigation-1.1/tabsets.js"></script>
<link href="Data_prep_C1_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Data_prep_C1_files/highlightjs-9.12.0/highlight.js"></script>
<script src="Data_prep_C1_files/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data Preparation and Standardization</h1>

</div>


<style>
.tablelines table, .tablelines td, .tablelines th {
        border: 1px solid black;
        }
.centrado {
    text-align: center;
}
.justificado {
    text-align: justify;
}
.alert-danger {
  color: rgb(169,68,66) !important;
}
.alert-green {
  color: rgb(60,118,61) !important;
}
.purple {
    color:inherit;
  }
.purple:hover {
    color:rgb(107,79,187);
  }
.blue {
  color: blue;
}
.emphasized {
   font-size: .8em;
}
.note {
   font-size: .9em;
}
.table.center {
    margin-left:auto; 
    margin-right:auto;
  }
.table_wrapper{
    display: block;
    overflow-x: auto;
    white-space: nowrap;
}
</style>
<!---

[//]: # (This is <span style="color: red">written in red</span>.)

[//]: # (Hey! Hover the cursor over me and guess what?! :) {: .purple})

[//]: # (I am in <span style="font-family:Papyrus; font-size:4em;">that!</span>)

[//]: #(#687886)

-->
<p>This page will be used to comment and understand the steps, advances and douts about the process of data preparations and standardization of the SISTRAT C1 (Convenio 1) which can be translated to Agreement on Collaboration, Technical Assistance and Transfer of Resources to General Population (“Convenio de Colaboración Técnica y de Transferencia de Recursos para Programa de Población General”). Must note that it does not include Adolescent criminal offenders (C2).</p>
<p>To see the TOP or Profile of Treatment Results (“Perfil de Resultados de Tratamiento”) datasets, <a href="top_info.md#include-generated-text">go to this webpage</a>.</p>
<p><br> ### Building dataset</p>
<p>Define working directories which contains different text files that will be merged, correspondent to the years of the C1 Sistrat.</p>
<pre class="markdown"><code>dir_c1 &lt;-toString(paste0(getwd(),&quot;/Encriptado c1/Personas tratadas c1/&quot;))
dir_top &lt;-toString(paste0(getwd(),&quot;/encriptados TOP/&quot;))</code></pre>
<p>Define files in the Directory folder, as long as they have the excel extension and they do not start with ~ (represent a working temporary file in excel)</p>
<pre class="markdown"><code>SISTRAT_c1&lt;-list.files(path=toString(dir_c1), all.files=T, pattern=&quot;^[2].*\\s*txt$&quot;)</code></pre>
<p>SISTRAT_c1 is composed by the following files: * 2010tab-Resultado-20191113 (1).txt * 2011tab -Resultado-20191113.txt * 2012tab-Resultado-20191113.txt * 2013tab-Resultado-20191113.txt * 2014tab-Resultado-20191113.txt * 2015tab-Resultado-20191113.txt * 2016tab-Resultado-20191113.txt * 2017tab-Resultado-20191113.txt * 2018tab-Resultado-20191113.txt * 2019_EneOcttab-Resultado-20191113.txt</p>
<p>Function to <strong>read tab delimited text files</strong>, with UTF-8 encoding and, based on the first 7 letters of its name, assign them an object name.</p>
<pre class="markdown"><code>read_excel_mult &lt;- function(dir, filename) {
  assign(paste0(substr(filename, 1, 7)),read.delim(paste0(dir, filename),
        na.strings=&quot;null&quot;, header = T, fileEncoding=&quot;UTF-8&quot;),envir = .GlobalEnv)
  }</code></pre>
<p><br> #### Import datasets</p>
<p>To import the datasets, we apply the previous function to every dataset</p>
<pre class="markdown"><code>for (x in SISTRAT_c1) {
  read_excel_mult(as.character(dir_c1), x)
}</code></pre>
<p><br> #### Normalize datasets</p>
<p>Normalize datasets by defining a common name for hash key’s (“HASH_KEY”) and assign them an standardized name.</p>
<pre class="markdown"><code>tab_10_18_mod &lt;- function(x,y) {  get(x) %&gt;% dplyr::rename(&quot;HASH_KEY&quot; = !!names(.[91])) %&gt;%
    as.data.frame() %&gt;% 
    assign(paste0(y, as.character(x)),.,envir = .GlobalEnv)
}
for (i in paste0(c(2010:2018),&quot;tab&quot;)) {tab_10_18_mod(i,y=&quot;c1_&quot;)}

`2019_En` %&gt;% dplyr::rename(&quot;HASH_KEY&quot; = !!names(.[92])) %&gt;%
  as.data.frame() %&gt;% 
  assign(paste0(&quot;c1_&quot;, &quot;2019tab&quot;),.,envir = .GlobalEnv)</code></pre>
<p><br> #### Append the datasets</p>
<p>Once normalized column names. Bind every year’s datasets by their rows.</p>
<pre class="markdown"><code>CONS_C1=rbindlist(mget(paste0(&quot;c1_&quot;,c(2010:2019),&quot;tab&quot;)), idcol=&quot;TABLE&quot;, fill=T)
CONS_C1 &lt;- CONS_C1 %&gt;% dplyr::mutate(row=1:nrow(CONS_C1)) %&gt;% dplyr::select(row,everything())</code></pre>
<hr />
<hr />
<hr />
<hr />
<p><br> ## Define and format variable names</p>
<p>Redefine variable names, create a column named <em>ano_bd</em> with the year. Also, it reorder the variables to get the identifiers as the first columns.</p>
<div id="rename-variables" class="section level4">
<h4>Rename Variables</h4>
<pre class="markdown"><code>CONS_C1 %&gt;% 
  dplyr::rename(id=`Codigo.Identificación`) %&gt;%
  dplyr::rename(fech_ing=`Fecha.Ingreso.a.Tratamiento`) %&gt;%
  dplyr::rename(fech_egres=`Fecha.Egreso.de.Tratamiento`) %&gt;%
  dplyr::rename(dias_trat=`Dias.en.Tratamiento`) %&gt;%
  dplyr::rename(eva_consumo=`Evaluación.al.Egreso.Respecto.al.Patrón.de.consumo`) %&gt;%
  dplyr::rename(eva_fam=`Evaluación.al.Egreso.Respecto.a.Situación.Familiar`) %&gt;%
  dplyr::rename(eva_sm=`Evaluación.al.Egreso.Respecto.Salud.Mental`) %&gt;%
  dplyr::rename(eva_fisica=`Evaluación.al.Egreso.Respecto.Salud.Física`) %&gt;%
  dplyr::rename(eva_transgnorma=`Evaluación.al.Egreso.Respecto.Trasgresión.a.la.Norma.Social`) %&gt;% 
  dplyr::rename(eva_relinterp=`Evaluación.al.Egreso.Respecto.Relaciones.Interpersonales`) %&gt;%
  dplyr::rename(eva_ocupacion=`Evaluación.al.Egreso.Respecto.a.Situación.Ocupacional`) %&gt;%
  dplyr::rename(evaluacindelprocesoteraputico=`Evaluación.del.Proceso.Terapéutico`) %&gt;%
  dplyr::rename(nmesesentratamiento=`N.Meses.en.Tratamiento`) %&gt;%
  dplyr::rename(motivodeegreso=`Motivo.de.Egreso`) %&gt;%
  dplyr::rename(tipo_centro=`Tipo.Centro`) %&gt;%
  dplyr::mutate(ano_bd=as.numeric(substr(TABLE,4,7))) %&gt;%
  select(row, TABLE, HASH_KEY,ano_bd, everything()) %&gt;%
  dplyr::arrange(id) %&gt;%
  assign(&quot;CONS_C1_df&quot;,.,envir = .GlobalEnv)</code></pre>
<p>Relevant variables are converted into factors.</p>
<pre class="markdown"><code>CONS_C1_df %&gt;%
  dplyr::mutate(motivodeegreso=as.factor(motivodeegreso)) %&gt;%
  dplyr::mutate(evaluacindelprocesoteraputico=as.factor(evaluacindelprocesoteraputico)) %&gt;%
  dplyr::mutate(eva_consumo=as.factor(eva_consumo)) %&gt;%
  dplyr::mutate(eva_fam=as.factor(eva_fam)) %&gt;%  
  dplyr::mutate(eva_relinterp=as.factor(eva_relinterp)) %&gt;%  
  dplyr::mutate(eva_ocupacion=as.factor(eva_ocupacion)) %&gt;%
  dplyr::mutate(eva_sm=as.factor(eva_sm)) %&gt;%  
  dplyr::mutate(eva_fisica=as.factor(eva_fisica)) %&gt;%
  dplyr::mutate(eva_transgnorma=as.factor(eva_transgnorma)) %&gt;%  
  dplyr::mutate(sexo=as.factor(Sexo)) %&gt;%
  dplyr::mutate(embarazo=as.factor(`X.Se.trata.de.una.mujer.embarazada.`)) %&gt;%
  dplyr::mutate(tipo_de_plan=as.factor(`Tipo.de.Plan`)) %&gt;%  
  dplyr::mutate(tipo_de_programa=as.factor(`Tipo.de.Programa`)) %&gt;%  
  assign(&quot;CONS_C1_df&quot;,.,envir = .GlobalEnv) </code></pre>
<p><br> #### Standardize Dates <br> Dates of admission and discharge <br></p>
<p>Most of the dates were not formatted equally. When standardized,some cases failed to transform dates, specifically in dates of discharge, which contained 87 cases, while only one case was problematic in admission dates.</p>
<pre class="markdown"><code>CONS_C1_df %&gt;%
  dplyr::mutate(fech_ing= ifelse(row==&quot;14504&quot;, &quot;10/01/2011&quot;,fech_ing))  %&gt;%
  dplyr::mutate(fech_ing= lubridate::parse_date_time(fech_ing, c(&quot;%d/%m/%Y&quot;),exact=T))
  dplyr::mutate(fech_egres_sin_fmt= fech_egres) %&gt;% #me quedo con esta variable por si acaso
  dplyr::mutate(fech_egres= ifelse(row==&quot;36308&quot;, &quot;02/04/2013&quot;,
                            ifelse(row==&quot;14083&quot;, &quot;03/05/2011&quot;,
                            ifelse(row==&quot;6349&quot;, &quot;01/07/2010&quot;,
                            ifelse(row==&quot;42741&quot;, &quot;02/08/2013&quot;,
                            ifelse(row==&quot;8608&quot;,&quot;01/02/2011&quot;,
                            ifelse(row==&quot;11709&quot;,&quot;01/02/2011&quot;,
                            ifelse(row==&quot;40486&quot;,&quot;03/07/2013&quot;,
                            ifelse(row==&quot;42521&quot;,&quot;09/07/2013&quot;,
                            ifelse(row==&quot;5757&quot;, &quot;10/04/2010&quot;,
                            ifelse(row==&quot;39507&quot;, &quot;02/07/2013&quot;,
                            ifelse(row==&quot;3195&quot;, &quot;04/10/2010&quot;,
                            ifelse(row==&quot;37845&quot;, &quot;01/07/2013&quot;,
                            ifelse(row==&quot;40180&quot;, &quot;07/08/2013&quot;,
                            ifelse(row==&quot;28008&quot;, &quot;27/11/2012&quot;,
                            ifelse(row==&quot;35971&quot;, &quot;01/03/2013&quot;,
                            ifelse(row==&quot;5172&quot;, &quot;03/05/2011&quot;,
                            ifelse(row==&quot;10415&quot;, &quot;03/05/2011&quot;,
                            ifelse(row==&quot;16385&quot;, &quot;30/08/2011&quot;,
                            ifelse(row==&quot;39932&quot;, &quot;02/08/2013&quot;,
                            ifelse(row==&quot;16983&quot;, &quot;06/09/2011&quot;,
                            ifelse(row==&quot;37004&quot;, &quot;02/08/2013&quot;,fech_egres)))))))))))))))))))))) %&gt;%
  dplyr::mutate(fech_egres= lubridate::parse_date_time(stringr::str_trim(fech_egres), 
                                                       orders = c(&quot;%d/%m/%Y&quot;, &quot;%d/%m/%y&quot;,&quot;%d%m%Y&quot;),exact=T)) %&gt;%
  dplyr::arrange(desc(ano_bd)) %&gt;% 
  assign(&quot;CONS_C1_df&quot;,.,envir = .GlobalEnv)</code></pre>
<p>For discharge dates, many cases had different formats. Those had to be transformed once the first formats were traduced (e.g. 30-12-2019 is interpteted first as “%d/%m/%Y” format. If it is not traduced, it interprets in “DD/MM/YY” format (or “%d/%m/%y”). We can see in Table 1 in non-formatted date of discharge (<em>fech_egres_sin_fmt</em>), how was traduced into an official discharge date (<em>fech_egres</em>).</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:450px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 1. Problematic cases of discharge dates which required a manual change
</caption>
<thead>
<tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
Year
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
case
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
DischargeDate
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
DischargeDate-NoFmt
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
36,308
</td>
<td style="text-align:center;">
2013-04-02
</td>
<td style="text-align:center;">
2013/04/02
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
42,741
</td>
<td style="text-align:center;">
2013-08-02
</td>
<td style="text-align:center;">
2082013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
40,486
</td>
<td style="text-align:center;">
2013-07-03
</td>
<td style="text-align:center;">
307203
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
42,521
</td>
<td style="text-align:center;">
2013-07-09
</td>
<td style="text-align:center;">
9072013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
39,507
</td>
<td style="text-align:center;">
2013-07-02
</td>
<td style="text-align:center;">
2072013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
37,845
</td>
<td style="text-align:center;">
2013-07-01
</td>
<td style="text-align:center;">
1072013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
40,180
</td>
<td style="text-align:center;">
2013-08-07
</td>
<td style="text-align:center;">
7082013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
35,971
</td>
<td style="text-align:center;">
2013-03-01
</td>
<td style="text-align:center;">
01-03-2013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
39,932
</td>
<td style="text-align:center;">
2013-08-02
</td>
<td style="text-align:center;">
2082013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,013
</td>
<td style="text-align:center;">
37,004
</td>
<td style="text-align:center;">
2013-08-02
</td>
<td style="text-align:center;">
2082013
</td>
</tr>
<tr>
<td style="text-align:center;">
2,012
</td>
<td style="text-align:center;">
28,008
</td>
<td style="text-align:center;">
2012-11-27
</td>
<td style="text-align:center;">
27-11-2012
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
14,083
</td>
<td style="text-align:center;">
2011-05-03
</td>
<td style="text-align:center;">
30520011
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
11,709
</td>
<td style="text-align:center;">
2011-02-01
</td>
<td style="text-align:center;">
01-02-2011
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
10,415
</td>
<td style="text-align:center;">
2011-05-03
</td>
<td style="text-align:center;">
3052011
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
16,385
</td>
<td style="text-align:center;">
2011-08-30
</td>
<td style="text-align:center;">
30/08/20011
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
16,983
</td>
<td style="text-align:center;">
2011-09-06
</td>
<td style="text-align:center;">
06-09-2011
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
6,349
</td>
<td style="text-align:center;">
2010-07-01
</td>
<td style="text-align:center;">
01707/2010
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
8,608
</td>
<td style="text-align:center;">
2011-02-01
</td>
<td style="text-align:center;">
01-02-2011
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
5,757
</td>
<td style="text-align:center;">
2010-04-10
</td>
<td style="text-align:center;">
4102010
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
3,195
</td>
<td style="text-align:center;">
2010-10-04
</td>
<td style="text-align:center;">
4102010
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
5,172
</td>
<td style="text-align:center;">
2011-05-03
</td>
<td style="text-align:center;">
3052011
</td>
</tr>
</tbody>
</table>
</div>
<p><br> As we can see in Table 2, some non-formatted date of discharge (<em>fech_egres_sin_fmt</em>), had insufficient information to traduce into valid dates.</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:150px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 2. Non-interpretable discharge dates
</caption>
<thead>
<tr>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
Year
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
case
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
DischargeDate
</th>
<th style="text-align:center;position: sticky; top:0; background-color: #FFFFFF;">
DischargeDate-NoFmt
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
12,006
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
12,005
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
2,011
</td>
<td style="text-align:center;">
12,227
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
25
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
8,239
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
15
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
9,043
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
2,603
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
20/0/2010
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
9,042
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
194
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
15
</td>
</tr>
<tr>
<td style="text-align:center;">
2,010
</td>
<td style="text-align:center;">
9,353
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
25
</td>
</tr>
</tbody>
</table>
</div>
<p><br> <strong><em> </em></strong></p>
</div>
<div id="data-cleaning-steps-provided-by-sendas-professional" class="section level2">
<h2>Data Cleaning Steps provided by SENDA’s professional</h2>
<p>This rules were provided by SENDA’s professionals, in order to select adequate data for the analysis.</p>
<p><br> #### 1- Exclude not SENDA treatments</p>
<p>In first place, we should discard treatments not provided by SENDA.</p>
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 3. Treatment Admissions
</caption>
<thead>
<tr>
<th style="text-align:center;">
SENDA
</th>
<th style="text-align:center;">
Frequency
</th>
<th style="text-align:center;">
%
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
No
</td>
<td style="text-align:center;">
7,762
</td>
<td style="text-align:center;">
4.8%
</td>
</tr>
<tr>
<td style="text-align:center;">
Si
</td>
<td style="text-align:center;">
155,382
</td>
<td style="text-align:center;">
95.2%
</td>
</tr>
<tr>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0%
</td>
</tr>
</tbody>
</table>
<p><br> As we can see in Table 3, around 4.8% of cases had a treatment that could be not part of SENDA’s agreements. <br> <br></p>
<div id="explore-if-the-type-of-plan" class="section level4">
<h4>2. Explore if the type of plan</h4>
<p><br></p>
<p>It is necessary to explore if there is any case that may have a treatment under a probation/parole (“libertad vigilada”) plan.</p>
<pre><code>## Warning: Factor `tipo_de_plan` contains implicit NA, consider using
## `forcats::fct_explicit_na`</code></pre>
<pre><code>## Warning in melt.data.table(., id.vars = c(1:2)): &#39;measure.vars&#39; [count,
## perc] are not all of the same type. By order of hierarchy, the molten data
## value column will be of type &#39;character&#39;. All measure variables not of type
## &#39;character&#39; will be coerced too. Check DETAILS in ?melt.data.table for more on
## coercion.</code></pre>
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 4. Treatment Plans
</caption>
<thead>
<tr>
<th style="text-align:center;">
Type of Plan
</th>
<th style="text-align:center;">
No SENDA(n)
</th>
<th style="text-align:center;">
No SENDA(%)
</th>
<th style="text-align:center;">
Yes SENDA(n)
</th>
<th style="text-align:center;">
Yes SENDA(%)
</th>
<th style="text-align:center;">
NA (n)
</th>
<th style="text-align:center;">
NA (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
CALLE
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PAB
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
109
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PAI
</td>
<td style="text-align:center;">
137
</td>
<td style="text-align:center;">
2%
</td>
<td style="text-align:center;">
10533
</td>
<td style="text-align:center;">
7%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PAI2
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
16
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PR
</td>
<td style="text-align:center;">
251
</td>
<td style="text-align:center;">
3%
</td>
<td style="text-align:center;">
7588
</td>
<td style="text-align:center;">
5%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PR2
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
Otro
</td>
<td style="text-align:center;">
1778
</td>
<td style="text-align:center;">
23%
</td>
<td style="text-align:center;">
90
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
PAI LV
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
PG-PAB
</td>
<td style="text-align:center;">
2236
</td>
<td style="text-align:center;">
29%
</td>
<td style="text-align:center;">
54075
</td>
<td style="text-align:center;">
35%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
PG-PAI
</td>
<td style="text-align:center;">
2233
</td>
<td style="text-align:center;">
29%
</td>
<td style="text-align:center;">
66300
</td>
<td style="text-align:center;">
43%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
PG-PR
</td>
<td style="text-align:center;">
1116
</td>
<td style="text-align:center;">
14%
</td>
<td style="text-align:center;">
16599
</td>
<td style="text-align:center;">
11%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
PG PAI 2
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
50
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
100%
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>*</sup> PR= Residential Program
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>†</sup> PAB= Basic Outpatient Program
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>‡</sup> PAI= Intensive Outpatient Treatment
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>§</sup> PAI LV= Probation/Parole
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>¶</sup> PAI= Intensive Outpatient Treatment
</td>
</tr>
</tfoot>
</table>
<p><br></p>
<p>Table 4 shows that there is only 1 case in the probation/parole plan. <br></p>
</div>
<div id="changes-in-programs" class="section level4">
<h4>3. Changes in programs</h4>
<p>Change fixed residential, flexible residential and residential programmes into a general population residential program (PG PR). Additionally, flexible residential program cannot be under a probation/parole program.</p>
<p>Must note that there are <strong><em>some plans that have a number 2</em></strong> but they do not contain more than 0% of the total of the datasets. Also there is some plans related to the Treatment of People Living on the Streets Programs (Programa de Tratamiento de Personas en Situación de Calle). <strong><em>For the moment, we are not sure what is the fixed and flexible residential programmes</em></strong>.</p>
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 5. Contingency Tables of Programs by Plans
</caption>
<thead>
<tr>
<th style="text-align:center;">
Type of Program
</th>
<th style="text-align:center;">
CALLE
</th>
<th style="text-align:center;">
M-PAB
</th>
<th style="text-align:center;">
M-PAI
</th>
<th style="text-align:center;">
M-PAI2
</th>
<th style="text-align:center;">
M-PR
</th>
<th style="text-align:center;">
M-PR2
</th>
<th style="text-align:center;">
Otro
</th>
<th style="text-align:center;">
PAI LV
</th>
<th style="text-align:center;">
PG-PAB
</th>
<th style="text-align:center;">
PG-PAI
</th>
<th style="text-align:center;">
PG-PR
</th>
<th style="text-align:center;">
PG PAI 2
</th>
<th style="text-align:center;">
NA
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Libertad Vigilada
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
Otro
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
890
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
35
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
Programa Alcohol
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
80
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
Programa Calles
</td>
<td style="text-align:center;">
15
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
Programa Específico Mujeres
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
115
</td>
<td style="text-align:center;">
9,741
</td>
<td style="text-align:center;">
16
</td>
<td style="text-align:center;">
7,590
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
19
</td>
<td style="text-align:center;">
48
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
16
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
Programa Población General
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
926
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
246
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
971
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
56,260
</td>
<td style="text-align:center;">
68,368
</td>
<td style="text-align:center;">
17,700
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
3
</td>
</tr>
</tbody>
</table>
<p><br> #### 4. Plans within Alcohol Program</p>
<p>If there is a plan within the alcohol program, the plan must be modificated into the general population plan. <br></p>
<p>Every of the PG-PAI, 80 cases in the alcohol program are in the general population plan.</p>
<p><br> #### 5. Another Plan</p>
<p>If there is any plan correspondent to Another (“Otro”), it changes into a general population program. <br></p>
<p>There are 1868 cases with treatments categorized as Another (“Otro”) plan.</p>
<p><br> #### 6.Plan &amp; Programs by Sex</p>
<p>Women should be in the M-PAI in they actually are cathegorized in the general population program. <br></p>
<p>As can be seen in Table 6, around 16% of women are in the general population programmes.<strong>Should be removed?</strong></p>
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 6. Plan by Sex
</caption>
<thead>
<tr>
<th style="text-align:center;">
Plan
</th>
<th style="text-align:center;">
Man (n)
</th>
<th style="text-align:center;">
Man (%)
</th>
<th style="text-align:center;">
Women (n)
</th>
<th style="text-align:center;">
Women (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
CALLE
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0%
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PAB
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
115
</td>
<td style="text-align:center;">
0.1%
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PAI
</td>
<td style="text-align:center;">
86
</td>
<td style="text-align:center;">
0.1%
</td>
<td style="text-align:center;">
10584
</td>
<td style="text-align:center;">
6.5%
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PAI2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
16
</td>
<td style="text-align:center;">
0%
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PR
</td>
<td style="text-align:center;">
68
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
7771
</td>
<td style="text-align:center;">
4.8%
</td>
</tr>
<tr>
<td style="text-align:center;">
M-PR2
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
0%
</td>
</tr>
<tr>
<td style="text-align:center;">
Otro
</td>
<td style="text-align:center;">
1305
</td>
<td style="text-align:center;">
0.8%
</td>
<td style="text-align:center;">
563
</td>
<td style="text-align:center;">
0.3%
</td>
</tr>
<tr>
<td style="text-align:center;">
PAI LV
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0%
</td>
</tr>
<tr>
<td style="text-align:center;">
PG-PAB
</td>
<td style="text-align:center;">
44527
</td>
<td style="text-align:center;">
27.3%
</td>
<td style="text-align:center;">
11784
</td>
<td style="text-align:center;">
7.2%
</td>
</tr>
<tr>
<td style="text-align:center;">
PG-PAI
</td>
<td style="text-align:center;">
54142
</td>
<td style="text-align:center;">
33.2%
</td>
<td style="text-align:center;">
14391
</td>
<td style="text-align:center;">
8.8%
</td>
</tr>
<tr>
<td style="text-align:center;">
PG-PR
</td>
<td style="text-align:center;">
17057
</td>
<td style="text-align:center;">
10.5%
</td>
<td style="text-align:center;">
658
</td>
<td style="text-align:center;">
0.4%
</td>
</tr>
<tr>
<td style="text-align:center;">
PG PAI 2
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
0%
</td>
</tr>
<tr>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0%
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0%
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>*</sup> PR= Residential Program
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>†</sup> PAB= Basic Outpatient Program
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>‡</sup> PAI= Intensive Outpatient Treatment
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>§</sup> PAI LV= Probation/Parole
</td>
</tr>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup>¶</sup> PAI= Intensive Outpatient Treatment
</td>
</tr>
</tfoot>
</table>
<p>There are still a few doubts about these criteria: - <strong>Why there is men and women with female gender identity that are in the general population?, (Basic outpatient (22 men; 690 women), intensive outpatient (33 men; 1098 women), Residential (5 men; 26 women) and Outpatient 2 (12 women)?</strong> - <strong>Should the 2 men and 12 women in M-PAI but with masculine gender identity be in general population (PG PAI)?</strong> - <strong>If in M-PR there is a women with masculine gender identity, should not be in the general population (PG_PR)?</strong></p>
<p><br> #### 7.Plan &amp; Programs by Sex</p>
<p>Only plans “M-PAI”, “M-PR”, “PG-PAB”, “PG-PAI” and “PG-PR” must be preserved. <strong>Considering Table 4, what happens with M-PAB (basic outpatient for women), “Calle”, “PG PAI 2”, “M-PAI2”, “M-PR2”, “PAI LV” or another (“Otro”)? (See Table 4)</strong></p>
<p><br> #### 8.Age of consumption begin</p>
<p>Treat as missing data the age of consumption begin if it is less than 5 years.</p>
<pre class="r"><code>  par(mfrow = c(1,2)) 
  hist(CONS_C1_df$Edad.Inicio.Consumo, main=&quot;Distribution of Age\nof Consumption Begin&quot;, 
       xlab=&quot;Age&quot;, ylab=&quot;Freq&quot;, breaks=30, xlim=c(0,80))
  hist(CONS_C1_df$Edad.Inicio.Consumo, main=&quot;Distribution of Age\nof Consumption Begin (zoom)&quot;, 
       xlab=&quot;Age&quot;, ylab=&quot;Freq&quot;, breaks=30, xlim=c(0,10), ylim=c(0,20000))</code></pre>
<p><img src="Data_prep_C1_files/figure-html/bunch_o_figs-1.png" width="768" /></p>
</div>
<div id="figure-1.-histogram-of-age-of-consumption-begin" class="section level4">
<h4>Figure 1. Histogram of Age of Consumption Begin</h4>
<pre class="r"><code>include_graphics(paste0(path,&quot;/Figures/Fig1.png&quot;))</code></pre>
<p><img src="Figures/Fig1.png" width="539" /></p>
<pre class="markdown"><code>  CONS_C1_df %&gt;%
  dplyr::filter(Edad.Inicio.Consumo&lt;5) %&gt;%
  dplyr::summarise(n())</code></pre>
<p>There is around 1,117 cases with less than 5 years in the consumption begin.</p>
<p><br> #### 9.Delete duplicated cases (same date of admission and ID)</p>
<p>In this case, we included the HASH-KEY as another and more robust criteria to filter duplicate cases.</p>
<pre class="markdown"><code>    CONS_C1_df %&gt;% 
        mutate(concat=paste0(as.character(id),&quot;_&quot;,fech_ing,&quot;_&quot;,as.character(HASH_KEY))) %&gt;%
        dplyr::filter(duplicated(concat)) %&gt;%
        dplyr::arrange(concat) %&gt;%
        dplyr::select(concat, everything()) %&gt;%
        dim()
    length(which(duplicated(CONS_C1_df[c(&#39;id&#39;, &#39;fech_ing&#39;,&#39;HASH_KEY&#39;)]),) )

    data.frame(table(with(CONS_C1_df, ifelse(duplicated(CONS_C1_df[c(&#39;id&#39;, &#39;fech_ing&#39;,&#39;HASH_KEY&#39;)]), 0, 1))),
             `%`=paste0(round(prop.table(  table(with(CONS_C1_df, 
            ifelse(duplicated(CONS_C1_df[c(&#39;id&#39;, &#39;fech_ing&#39;,&#39;HASH_KEY&#39;)]), 0, 1)))),3)*100,&quot;%&quot;)) %&gt;%
    pander::pandoc.table(., split.tables=Inf, style=&#39;rmarkdown&#39;)</code></pre>
</div>
<div id="table-7.-duplicated-cases" class="section level4">
<h4>Table 7. Duplicated cases</h4>
<table>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Frequencies</th>
<th align="center">Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Duplicates</td>
<td align="center">45445</td>
<td align="center">27.9%</td>
</tr>
<tr class="even">
<td align="center">Not duplicates</td>
<td align="center">117701</td>
<td align="center">72.1%</td>
</tr>
</tbody>
</table>
<p>As seen in Table 7, there is more than a quarter of cases that may be replicating across the different datasets.</p>
<p><br> #### 10.Actual Age</p>
<p>Consider as missing age if it is less than 18 years and greater than 90.</p>
<pre class="markdown"><code>    par(mfrow = c(1,3)) 
    hist(CONS_C1_df$Edad, main=&quot;Distrbution of Age&quot;, 
         xlab=&quot;Edad&quot;, ylab=&quot;Freq&quot;, breaks=60)
    hist(CONS_C1_df$Edad, main=&quot;Distrbution of Age (zoom -)&quot;, 
         xlab=&quot;Edad&quot;, ylab=&quot;Freq&quot;, breaks=60, xlim=c(0,20), ylim=c(0,2000))
    hist(CONS_C1_df$Edad, main=&quot;Distrbution of Age (zoom +)&quot;, 
         xlab=&quot;Edad&quot;, ylab=&quot;Freq&quot;, breaks=60, xlim=c(100,120), ylim=c(0,100)) 
        dev.off()</code></pre>
</div>
<div id="figure-2.-histogram-of-actual-age" class="section level4">
<h4>Figure 2. Histogram of Actual Age</h4>
<pre class="r"><code>include_graphics(paste0(path,&quot;/Figures/Fig2.png&quot;))</code></pre>
<p><img src="Figures/Fig2.png" width="539" /></p>
<pre class="markdown"><code>    CONS_C1_df %&gt;%
      dplyr::filter(Edad&lt;18) %&gt;%
      dplyr::summarise(n())

    CONS_C1_df %&gt;%
      dplyr::filter(Edad&gt;90) %&gt;%
      dplyr::summarise(n())</code></pre>
<p>There are 673 cases with less than 18 years, 24 cases with more than 90 years.</p>
<p><br> #### 11. Days In Treatment</p>
<p>Consider as missing if cases has more than 1095 days. Do the same for months in treatment.</p>
<pre class="markdown"><code>    par(mfrow = c(1,2)) 
    hist(CONS_C1_df$dias_trat, main=&quot;Distribution of\nDays in Treatment&quot;, 
         xlab=&quot;Días&quot;, ylab=&quot;Freq&quot;,xlim=c(-100,4100), breaks=60)
    hist(CONS_C1_df$dias_trat, main=&quot;Distribution of\nDays in Treatment (zoom +)&quot;, 
         xlab=&quot;Días&quot;, ylab=&quot;Freq&quot;, breaks=60, xlim=c(1000,4100), ylim=c(0,2000)) 
    dev.off()
    #values out of boundaries
    CONS_C1_df %&gt;%
      dplyr::filter(dias_trat&gt;1095) %&gt;%
      dplyr::summarise(n())

    CONS_C1_df %&gt;%
      dplyr::filter(dias_trat&lt;0) %&gt;%
      dplyr::summarise(n())</code></pre>
<p>As seen in Figure 3, there are 2320 cases with more than 1095 days in treatment. On the other hand, there are 12 cases with negative days of treatment. <strong>Should be removed?</strong></p>
</div>
<div id="figure-3.-histogram-of-days-in-treatment" class="section level4">
<h4>Figure 3. Histogram of Days In Treatment</h4>
<pre class="r"><code>include_graphics(paste0(path,&quot;/Figures/Fig3.png&quot;))</code></pre>
<p><img src="Figures/Fig3.png" width="539" /></p>
<p><br> #### 12. Pregnancy and Sex</p>
<p>Pregnant men should be considered as missing values. As seen in Table 8, 4 cases of men also reported pregnancy.</p>
<pre class="markdown"><code>    data.frame(table(CONS_C1_df$embarazo, CONS_C1_df$Sexo, exclude=NULL),
               `%`=paste0(round(prop.table(table(CONS_C1_df$embarazo, CONS_C1_df$Sexo, exclude=NULL)),3)*100,&quot;%&quot;)) %&gt;% 
      as.data.frame() %&gt;% 
      reshape::melt( id.vars = c(&quot;Var1&quot;, &quot;Var2&quot;)) %&gt;%
      reshape::cast(.,Var1~Var2+variable) %&gt;%
      pander::pandoc.table(., split.tables=Inf, style=&#39;rmarkdown&#39;)</code></pre>
</div>
<div id="table-8.-pregnancy-by-sex" class="section level4">
<h4>Table 8. Pregnancy by Sex</h4>
<table>
<thead>
<tr class="header">
<th align="center">Pregnant</th>
<th align="center">Men (n)</th>
<th align="center">Men (%)</th>
<th align="center">Women (n)</th>
<th align="center">Women (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">No</td>
<td align="center">9,515</td>
<td align="center">5.8%</td>
<td align="center">43,466</td>
<td align="center">26.6%</td>
</tr>
<tr class="even">
<td align="center">Si</td>
<td align="center">4</td>
<td align="center">0%</td>
<td align="center">2,430</td>
<td align="center">1.5%</td>
</tr>
<tr class="odd">
<td align="center">NA</td>
<td align="center">107,709</td>
<td align="center">66%</td>
<td align="center">22</td>
<td align="center">0%</td>
</tr>
</tbody>
</table>
<p><br> #### 13. Type of plan and Sex</p>
<p>See plans M-PR and M-PAI . Check if there are men. Keep if they are, but they identify as women. **This should also be checked reversly?</p>
<p>As seen in table 9, must note that many cases do not answer this question, or what could be more plausible, this question could not be present in previous datasets. This is why we may exclude NA’s (missing values) for the following analysis.</p>
<pre class="markdown"><code>     data.frame(table(CONS_C1_df$identidad.de.genero, CONS_C1_df$Sexo, exclude=NULL),
               `%`=paste0(round(prop.table(table(CONS_C1_df$identidad.de.genero, CONS_C1_df$Sexo, exclude=NULL)),3)*100,&quot;%&quot;)) %&gt;% 
      as.data.frame() %&gt;% 
      reshape::melt( id.vars = c(&quot;Var1&quot;, &quot;Var2&quot;)) %&gt;%
      reshape::cast(.,Var1~Var2+variable) %&gt;%
      pander::pandoc.table(., split.tables=Inf, style=&#39;rmarkdown&#39;)</code></pre>
</div>
<div id="table-9.-sex-by-gender-identity" class="section level4">
<h4>Table 9. Sex by Gender Identity</h4>
<table>
<thead>
<tr class="header">
<th align="center">Var1</th>
<th align="center">Men (n)</th>
<th align="center">Men(%)</th>
<th align="center">Women(n)</th>
<th align="center">Women(%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Femenine</td>
<td align="center">65</td>
<td align="center">0%</td>
<td align="center">3,249</td>
<td align="center">2%</td>
</tr>
<tr class="even">
<td align="center">Masculine</td>
<td align="center">8,012</td>
<td align="center">4.9%</td>
<td align="center">60</td>
<td align="center">0%</td>
</tr>
<tr class="odd">
<td align="center">NA</td>
<td align="center">109,151</td>
<td align="center">66.9%</td>
<td align="center">42,609</td>
<td align="center">26.1%</td>
</tr>
</tbody>
</table>
<p>In Table 10, can be seen that there are 2 men with a masculine gender identity that are suscribed to M-PAI plan. However, <strong>what happens with the 12 women with masculine gender identity in M-PAI plan?</strong></p>
<pre class="markdown"><code>    CONS_C1_df %&gt;%
      dplyr::group_by(as.factor(identidad.de.genero),as.factor(Sexo), as.factor(tipo_de_plan)) %&gt;%
      dplyr::filter(!is.na(as.factor(identidad.de.genero))) %&gt;%
      dplyr::summarise(count = n() ) %&gt;%
      dplyr::mutate(perc = paste0(round(100 * count/sum(count), 0), &quot;%&quot;)) %&gt;%    
      dplyr::rename(tipo_plan = `as.factor(tipo_de_plan)`, sexo = `as.factor(Sexo)`, id_gen=`as.factor(identidad.de.genero)`) %&gt;%
      data.table() %&gt;%
      reshape::melt( id.vars = c(1:3)) %&gt;% 
      #reshape::cast(.,as.factor(tipo_de_plan)~variable+as.factor(Sexo)) %&gt;%
      reshape::cast(.,tipo_plan~sexo+id_gen+variable) %&gt;%
      dplyr::rename(&quot;Fem.-Men(n)&quot; = `Hombre_Femenino_count`, &quot;Masc.-Men(n)&quot; = `Hombre_Masculino_count`,
                    &quot;Fem.-Women(n)&quot;=`Mujer_Femenino_count`,&quot;Masc.-Women(n)&quot;=`Mujer_Masculino_count`,
                    &quot;Fem.-Men(%)&quot;=`Hombre_Femenino_perc`, &quot;Masc.-Men(%)&quot;=`Hombre_Masculino_perc`,
                     &quot;Fem.-Women(%)&quot;= `Mujer_Femenino_perc`,&quot;Masc.-Women(%)&quot;=`Mujer_Masculino_perc`) %&gt;% 
      pander::pandoc.table(., split.tables=Inf, style=&#39;rmarkdown&#39;)</code></pre>
</div>
<div id="table-10.-type-of-plan-by-gender-identity-and-sex" class="section level4">
<h4>Table 10. Type of Plan by Gender Identity and Sex</h4>
<table>
<colgroup>
<col width="8%" />
<col width="10%" />
<col width="10%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="11%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Plans</th>
<th align="center">Fem.-Men(n)</th>
<th align="center">Fem.-Men(%)</th>
<th align="center">Masc.-Men(n)</th>
<th align="center">Masc.-Men(%)</th>
<th align="center">Fem.-Women(n)</th>
<th align="center">Fem.-Women(%)</th>
<th align="center">Masc.-Women(n)</th>
<th align="center">Masc.-Women(%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">M-PAI</td>
<td align="center">2</td>
<td align="center">3%</td>
<td align="center">2</td>
<td align="center">0%</td>
<td align="center">877</td>
<td align="center">27%</td>
<td align="center">12</td>
<td align="center">20%</td>
</tr>
<tr class="even">
<td align="center">M-PAI2</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">16</td>
<td align="center">0%</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">M-PR</td>
<td align="center">2</td>
<td align="center">3%</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">505</td>
<td align="center">16%</td>
<td align="center">1</td>
<td align="center">2%</td>
</tr>
<tr class="even">
<td align="center">M-PR2</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">10</td>
<td align="center">0%</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">Otro</td>
<td align="center">1</td>
<td align="center">2%</td>
<td align="center">25</td>
<td align="center">0%</td>
<td align="center">15</td>
<td align="center">0%</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">PG-PAB</td>
<td align="center">22</td>
<td align="center">34%</td>
<td align="center">2,688</td>
<td align="center">34%</td>
<td align="center">690</td>
<td align="center">21%</td>
<td align="center">19</td>
<td align="center">32%</td>
</tr>
<tr class="odd">
<td align="center">PG-PAI</td>
<td align="center">33</td>
<td align="center">51%</td>
<td align="center">4,060</td>
<td align="center">51%</td>
<td align="center">1,098</td>
<td align="center">34%</td>
<td align="center">28</td>
<td align="center">47%</td>
</tr>
<tr class="even">
<td align="center">PG-PR</td>
<td align="center">5</td>
<td align="center">8%</td>
<td align="center">1,212</td>
<td align="center">15%</td>
<td align="center">26</td>
<td align="center">1%</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">PG PAI 2</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">25</td>
<td align="center">0%</td>
<td align="center">12</td>
<td align="center">0%</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
<p>{: .emphasized .table_wrapper}</p>
<p><it> <sub> Note. PR= Residential Program; PAB= Basic Outpatient Program; PAI= Intensive Outpatient Treatment; PAI LV= Probation/Parole; Percentage by gender &amp; sex </sub> </it></p>
<p><br> #### 14.Days of treatment</p>
<p>Consider as missing days if theres values 0 and negatives.</p>
<pre class="markdown"><code>    CONS_C1_df %&gt;%
      dplyr::filter(dias_trat&lt;1) %&gt;%
      dplyr::summarise(n())</code></pre>
<p>There is 280 values 0 or negative.</p>
<p><br> #### 15.Age of Consumption Begin and Actual Age</p>
<p>Consider the age of consumption begin as missing data if it is greater than the actual age.</p>
<pre class="markdown"><code>    CONS_C1_df %&gt;%
      dplyr::mutate(edad_inicio_cons= ifelse(Edad.Inicio.Consumo&gt;Edad, 1, 0)) %&gt;%
      dplyr::filter(edad_inicio_cons==1) %&gt;%
      dplyr::select(row,id,HASH_KEY,Edad.Inicio.Consumo, Edad) %&gt;%
      dim()</code></pre>
<p>In 780 cases the age of consumption begin is greater than the actual age.</p>
See <a href="Duplicates.html">here</a> for duplicates treatment. <em><code>em</code> tag</em> OR
<hr />
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
