<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data_prep_Top</title>

<script src="Data_prep_TOP_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Data_prep_TOP_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Data_prep_TOP_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Data_prep_TOP_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Data_prep_TOP_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Data_prep_TOP_files/navigation-1.1/tabsets.js"></script>
<link href="Data_prep_TOP_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Data_prep_TOP_files/highlightjs-9.12.0/highlight.js"></script>
<script src="Data_prep_TOP_files/kePrint-0.0.1/kePrint.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data_prep_Top</h1>

</div>


<style>
.tablelines table, .tablelines td, .tablelines th {
        border: 1px solid black;
        }
.centrado {
    text-align: center;
}
.justificado {
    text-align: justify;
}
.alert-danger {
  color: rgb(169,68,66) !important;
}
.alert-green {
  color: rgb(60,118,61) !important;
}
.purple {
    color:inherit;
  }
.purple:hover {
    color:rgb(107,79,187);
  }
.blue {
  color: blue;
}
.emphasized {
   font-size: .8em;
}
.note {
   font-size: .9em;
}
.table.center {
    margin-left:auto; 
    margin-right:auto;
  }
.table_wrapper{
    display: block;
    overflow-x: auto;
    white-space: nowrap;
}
code.r{
  font-size: 8px;
}
</style>
<!---

[//]: # (This is <span style="color: red">written in red</span>.)

[//]: # (Hey! Hover the cursor over me and guess what?! :) {: .purple})

[//]: # (I am in <span style="font-family:Papyrus; font-size:4em;">that!</span>)

[//]: #(#687886)

-->
<div id="data-preparation-of-top-dataset" class="section level1">
<h1>Data Preparation of TOP Dataset</h1>
<p> </p>
<p>TOP Profile of Treatment Results (“Perfil de Resultados de Tratamiento”) serves as a tool for monitoring and follow up of SUD treatments. This questionnaire must be completed at entry to treatment, each 3 months during treatment, at treatment discharge and some centers may register after discharge. Hence, it is important to capture the date of application and the date of admission, and in order to characterize each user, it is important to standardize his birth date.</p>
<p>  <br></p>
<div id="change-of-dates-of-admission-aplication-of-top-and-birth" class="section level3">
<h3>1. Change of Dates of Admission, Aplication of TOP and Birth</h3>
<p>As can be seen in Table 1, every date was formatted into dates in a format disposed to show first a 4-digit year, 2-digit month and day.</p>
<p><br></p>
<pre class="r"><code>#create the first changes into TOP dataset
CONS_TOP %&gt;%
  dplyr::mutate(ano_bd=as.numeric(substr(TABLE,4,7))) %&gt;%
  dplyr::mutate(id_mod=sub(&quot;(.{5}).&quot;, &quot;\\1*&quot;,as.character(ID))) %&gt;%
  dplyr::mutate(id_mod=sub(&quot;(.{6}).&quot;, &quot;\\1*&quot;,as.character(id_mod))) %&gt;% 
  dplyr::select(HASH_KEY, hash_rut_completo, id_mod, ID, ano_bd, everything()) %&gt;%
  dplyr::arrange(desc(ano_bd)) %&gt;% 
  assign(&quot;CONS_TOP_df&quot;,.,envir = .GlobalEnv)
#change dates
CONS_TOP_df %&gt;%
  dplyr::mutate(fech_ing= lubridate::parse_date_time(Fecha.de.Ingreso.a.Tratamiento, c(&quot;%d/%m/%Y&quot;),exact=T)) %&gt;% #No parse failures
  #dplyr::select(Fecha.de.Ingreso.a.Tratamiento,fech_ing) %&gt;% head() #To see how it responds to changes. Many null values
  dplyr::mutate(fech_ing_sin_fmt= Fecha.de.Ingreso.a.Tratamiento) %&gt;% #keep this variable for comparison
  dplyr::mutate(fech_ap_top= lubridate::parse_date_time(Fecha.Aplicación.TOP, c(&quot;%Y-%m-%d&quot;),exact=T)) %&gt;% #No parse failures
  #dplyr::select(Fecha.Aplicación.TOP,fech_ap_top) %&gt;% head() #To see how it responds to changes.
  dplyr::mutate(fech_nac= lubridate::parse_date_time(stringr::str_trim(Fecha.Nacimiento), 
                                                       orders = c(&quot;%d/%m/%Y&quot;),exact=T)) %&gt;%
  #dplyr::select(Fecha.Nacimiento,fech_nac) %&gt;% View() #To see how it responds to changes. No failures
  assign(&quot;CONS_TOP_df&quot;,.,envir = .GlobalEnv) #
#Example of transformations
CONS_TOP_df %&gt;%
  dplyr::select(Fecha.de.Ingreso.a.Tratamiento,fech_ing,Fecha.Aplicación.TOP,fech_ap_top,Fecha.Nacimiento,fech_nac) %&gt;% head() %&gt;%
  knitr::kable(.,format = &quot;html&quot;, format.args = list(decimal.mark = &quot;.&quot;, big.mark = &quot;,&quot;),
               caption=&quot;Table 1. Example of date of admission to treatment&quot;,
              col.names = c(&quot;Unformatted Date of Admission&quot;,&quot;Date of Admission&quot;, &quot;Unformatted Date of Application&quot;, &quot;Date of Application&quot;, &quot;Unformatted Date of Birth&quot;,&quot;Date of Birth&quot;),
                 align =rep(&#39;c&#39;, 6))  %&gt;%
  kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;),font_size = 10)</code></pre>
<table class="table table-striped table-hover" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Table 1. Example of date of admission to treatment
</caption>
<thead>
<tr>
<th style="text-align:center;">
Unformatted Date of Admission
</th>
<th style="text-align:center;">
Date of Admission
</th>
<th style="text-align:center;">
Unformatted Date of Application
</th>
<th style="text-align:center;">
Date of Application
</th>
<th style="text-align:center;">
Unformatted Date of Birth
</th>
<th style="text-align:center;">
Date of Birth
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
01/06/2015
</td>
<td style="text-align:center;">
2015-06-01
</td>
<td style="text-align:center;">
2019-04-12
</td>
<td style="text-align:center;">
2019-04-12
</td>
<td style="text-align:center;">
07/08/1980
</td>
<td style="text-align:center;">
1980-08-07
</td>
</tr>
<tr>
<td style="text-align:center;">
01/06/2015
</td>
<td style="text-align:center;">
2015-06-01
</td>
<td style="text-align:center;">
2019-01-04
</td>
<td style="text-align:center;">
2019-01-04
</td>
<td style="text-align:center;">
07/08/1980
</td>
<td style="text-align:center;">
1980-08-07
</td>
</tr>
<tr>
<td style="text-align:center;">
01/06/2015
</td>
<td style="text-align:center;">
2015-06-01
</td>
<td style="text-align:center;">
2019-06-03
</td>
<td style="text-align:center;">
2019-06-03
</td>
<td style="text-align:center;">
07/08/1980
</td>
<td style="text-align:center;">
1980-08-07
</td>
</tr>
<tr>
<td style="text-align:center;">
01/06/2015
</td>
<td style="text-align:center;">
2015-06-01
</td>
<td style="text-align:center;">
2019-08-09
</td>
<td style="text-align:center;">
2019-08-09
</td>
<td style="text-align:center;">
07/08/1980
</td>
<td style="text-align:center;">
1980-08-07
</td>
</tr>
<tr>
<td style="text-align:center;">
29/07/2015
</td>
<td style="text-align:center;">
2015-07-29
</td>
<td style="text-align:center;">
2019-02-27
</td>
<td style="text-align:center;">
2019-02-27
</td>
<td style="text-align:center;">
29/09/1984
</td>
<td style="text-align:center;">
1984-09-29
</td>
</tr>
<tr>
<td style="text-align:center;">
29/07/2015
</td>
<td style="text-align:center;">
2015-07-29
</td>
<td style="text-align:center;">
2019-04-29
</td>
<td style="text-align:center;">
2019-04-29
</td>
<td style="text-align:center;">
29/09/1984
</td>
<td style="text-align:center;">
1984-09-29
</td>
</tr>
</tbody>
</table>
<p>  <br></p>
<div id="figure-1." class="section level5">
<h5>Figure 1.</h5>
<p>In the transformation of dates of admission, we found an amount of missing values. However, there are 0 missing dates of application of the TOP and 0 missing birth dates.</p>
<p><br></p>
<div class="figure" style="text-align: center">
<img src="Data_prep_TOP_files/figure-html/fech_ing_nas-1.png" alt="Figure 1. Pie Chart of Missing Dates of Admission" width="672" />
<p class="caption">
Figure 1. Pie Chart of Missing Dates of Admission
</p>
</div>
<p><br></p>
<p>Considering the characteristics of TOP programs and monitoring, it may be possible to impute these dates from the C1 dataset, using the date of application if it is within the ranges of an specific treatment.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
