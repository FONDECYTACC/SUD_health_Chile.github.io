<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<h1><a href="#database-step-6" id="database-step-6">Database (step 6)</a></h1>
<p>Date created:  6 Dec 2021.</p>
<p>Install commands that are unavailable or out of date.</p>
<pre><code>. clear all

. *rnethelp &quot;http://www.stata-journal.com/software/sj13-1/st0289/stjm.sthlp&quot;
. 
. cap noi which predictms
C:\Users\CISS Fondecyt\ado\plus\p\predictms.ado
*! version 4.3.0 14mar2021 MJC

. if _rc==111 {
.         cap noi net install multistate, from(&quot;https://www.mjcrowther.co.uk/code/multistate&quot;) 
.         }

. cap noi which merlin
C:\Users\CISS Fondecyt\ado\plus\m\merlin.ado
*! version 2.0.2 19mar2021 MJC

. if _rc==111 {
.         cap noi net install merlin, from(&quot;https://www.mjcrowther.co.uk/code/merlin/&quot;) 
.         }

. cap noi which sumat
C:\Users\CISS Fondecyt\ado\plus\s\sumat.ado
*! Part of package matrixtools v. 0.25
*! Support: Niels Henrik Bruun, niels.henrik.bruun@gmail.com
*! 2021-01-03 toxl added

. if _rc==111 {
.         cap noi scc install matrixtools
.         }

. cap noi which estwrite
C:\Users\CISS Fondecyt\ado\plus\e\estwrite.ado
*! version 1.2.4 04sep2009
*! version 1.0.1 15may2007 (renamed from -eststo- to -estwrite-; -append- added)
*! version 1.0.0 29apr2005 Ben Jann (ETH Zurich)

. if _rc==111 {
.         cap noi ssc install estwrite
.         }       

.         
. cap noi which scurve_tvc
C:\Users\CISS Fondecyt\ado\plus\s\scurve_tvc.ado

. if _rc==111 {
.         cap noi net install st0458, from(&quot;http://www.stata-journal.com/software/sj16-4&quot;)
.         }

. cap noi which strmcure  
C:\Users\CISS Fondecyt\ado\plus\s\strmcure.ado
*! Version 4.0 31-Aug-2015

. if _rc==111 {
.         cap noi net install st0374_1, from (&quot;http://www.stata-journal.com/software/sj18-2&quot;)
.         }

. cap noi which stjmgraph 
C:\Users\CISS Fondecyt\ado\plus\s\stjmgraph.ado
*! version 1.0.2 01Jun2011 MJC

. if _rc==111 {
.         cap noi net install st0289, from (&quot;http://www.stata-journal.com/software/sj13-1&quot;)
.         }       

</code></pre>
<p>We need to obtain the file and the work folder.</p>
<pre><code>. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;/volumes/sdrive/data//&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;/volumes/sdrive/data//&quot;
.         global pathdata &quot;/volumes/sdrive/data//&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;E:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;E:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata &quot;E:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;E:/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;G:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;G:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata &quot;G:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;G:/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

.                 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)&quot;
C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)
.         global pathdata &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
Location= C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags; Date:  6 Dec 2021, considering an OS Windows for the user: CISS Fondecyt
. }

. else display &quot;This file does not exist&quot;

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;C:\Users\andre\Desktop\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;C:\Users\andre\Desktop\_mult_state_ags&quot;
.         global pathdata &quot;C:\Users\andre\Desktop\_mult_state_ags&quot;
.         global pathdata2 &quot;C:/Users/andre/Desktop/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;C:\Users\CISS Fondecyt\OneDrive\Documentos\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags
.         global pathdata &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
Location= C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags; Date:  6 Dec 2021, considering an OS Windows for the user: CISS Fondecyt
. }

. else display &quot;This file does not exist&quot;

. 
</code></pre>
<p>Path data= C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)_mult_state_ags;</p>
<p>Timestamp:  6 Dec 2021, considering that is a Windows OS for the username: CISS Fondecyt</p>
<p>The file is located and named as: C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/archivo_multiestado5_jun.dta</p>
<p>=============================================================================</p>
<h2><a href="#tables-residential-vs-ambulatory-of-the-first-treatment" id="tables-residential-vs-ambulatory-of-the-first-treatment">Tables- Residential vs. Ambulatory of the First Treatment</a></h2>
<p>=============================================================================</p>
<h3><a href="#zero-years" id="zero-years">Zero years</a></h3>
<h4><a href="#first-transition" id="first-transition">First transition</a></h4>
<pre><code>. use &quot;${pathdata2}archivo_multiestado5_jun.dta&quot;, clear

. 
. *fdiff_prob_from-&gt; diff. between residential and ambulatory treatment
. *fdiff_prob_from1_2_lci_rp_0 fdiff_prob_from1_2_uci_rp_0 fdiff_prob_from1_2_rp_0
. *fdiff_prob_from1_2_lci_rp_3y fdiff_prob_from1_2_uci_rp_3y fdiff_prob_from1_2_rp_3y
. *fdiff_prob_from1_2_lci_0_2 fdiff_prob_from1_2_uci_0_2 fdiff_prob_from1_2_0_2
. *fdiff_prob_from1_2_lci_3y_2 fdiff_prob_from1_2_uci_3y_2 fdiff_prob_from1_2_3y_2
. 
. foreach var of varlist fdiff_prob_from1_2_0 fdiff_prob_from1_2_lci_0 fdiff_prob_from1_2_uci_0 fdiff_prob_from1_2_0_2 fdiff_prob_from1_2_lci_0_2 fdiff_prob_from1_2_uci_0_2 {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
.02994,.0562,.06614,.06776
4 est
3
5.600000000000001
6.600000000000001
6.800000000000001
fdiff_prob_from1_2_0
3
.0262444307202025,.0466350619651055,.0589422611274193,.059050673143878
4 est
2.6
4.7
5.9
5.9
fdiff_prob_from1_2_lci_0
2.6
.0336347509322504,.0657546333109888,.0732226557276068,.0765671659409267
4 est
3.4
6.600000000000001
7.300000000000001
7.7
fdiff_prob_from1_2_uci_0
3.4
.01263,.0436,.05605,.06063
4 est
1.3
4.4
5.600000000000001
6.100000000000001
fdiff_prob_from1_2_0_2
1.3
.0105656329171381,.0384750745764451,.0479556736295462,.0532186328874907
4 est
1.1
3.8
4.800000000000001
5.300000000000001
fdiff_prob_from1_2_lci_0_2
1.1
.014694259422997,.048722631792619,.0641369653430527,.0680346879492718
4 est
1.5
4.9
6.4
6.800000000000001
fdiff_prob_from1_2_uci_0_2
1.5

. 
. matrix est_diff11 = (ests_fdiff_prob_from1_2_0, ests_fdiff_prob_from1_2_lci_0, ests_fdiff_prob_from1_2_uci_0, ests_fdiff_prob_from1_2_0_2, ests_fdiff_prob_from1_2_lci_0_2, ests_fdiff_prob_from1_2_uci_0_2)

. matrix colnames est_diff11 =  &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff11) using &quot;${pathdata2}diff_probs_res_out_mod_t1.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t1.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff11</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>           3</td><td>         2.6</td><td>         3.4</td><td>         1.3</td><td>         1.1</td><td>         1.5</td></tr>
<tr><td>1_yr        </td><td>         5.6</td><td>         4.7</td><td>         6.6</td><td>         4.4</td><td>         3.8</td><td>         4.9</td></tr>
<tr><td>3_yrs       </td><td>         6.6</td><td>         5.9</td><td>         7.3</td><td>         5.6</td><td>         4.8</td><td>         6.4</td></tr>
<tr><td>5_yrs       </td><td>         6.8</td><td>         5.9</td><td>         7.7</td><td>         6.1</td><td>         5.3</td><td>         6.8</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h4><a href="#second-transition" id="second-transition">Second transition</a></h4>
<pre><code>. foreach var of varlist fdiff_prob_from2_3_0 fdiff_prob_from2_3_lci_0 fdiff_prob_from2_3_uci_0 fdiff_prob_from2_3_0_2 fdiff_prob_from2_3_lci_0_2 fdiff_prob_from2_3_uci_0_2  {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
-.00926,-.00472,.00201,.00276
4 est
-.9
-.5
.2
.3
fdiff_prob_from2_3_0
-.9
-.0299781703723199,-.0230886351418562,-.0116621716625978,-.0054289526801415
4 est
-3
-2.3
-1.2
-.5
fdiff_prob_from2_3_lci_0
-3
.0094487302270669,.0114661236786322,.0136518208850227,.0171810235905751
4 est
.9
1.1
1.4
1.7
fdiff_prob_from2_3_uci_0
.9
-.00669,-.00172,.00216,.00394
4 est
-.7000000000000001
-.2
.2
.4
fdiff_prob_from2_3_0_2
-.7000000000000001
-.0281748626555205,-.0208648140322538,-.0109272362374433,-.0056476996846008
4 est
-2.8
-2.1
-1.1
-.6000000000000001
fdiff_prob_from2_3_lci_0_2
-2.8
.0099674363443012,.0148010409070271,.0174260749612576,.0188054946608991
4 est
1
1.5
1.7
1.9
fdiff_prob_from2_3_uci_0_2
1

. 
. matrix est_diff21 = (ests_fdiff_prob_from2_3_0, ests_fdiff_prob_from2_3_lci_0, ests_fdiff_prob_from2_3_uci_0, ests_fdiff_prob_from2_3_0_2, ests_fdiff_prob_from2_3_lci_0_2, ests_fdiff_prob_from2_3_uci_0_2)

. matrix colnames est_diff21 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff21) using &quot;${pathdata2}diff_probs_res_out_mod_t2.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t2.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff21</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>         -.9</td><td>          -3</td><td>          .9</td><td>         -.7</td><td>        -2.8</td><td>           1</td></tr>
<tr><td>1_yr        </td><td>         -.5</td><td>        -2.3</td><td>         1.1</td><td>         -.2</td><td>        -2.1</td><td>         1.5</td></tr>
<tr><td>3_yrs       </td><td>          .2</td><td>        -1.2</td><td>         1.4</td><td>          .2</td><td>        -1.1</td><td>         1.7</td></tr>
<tr><td>5_yrs       </td><td>          .3</td><td>         -.5</td><td>         1.7</td><td>          .4</td><td>         -.6</td><td>         1.9</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h4><a href="#third-transition" id="third-transition">Third transition</a></h4>
<pre><code>. foreach var of varlist fdiff_prob_from3_4_0 fdiff_prob_from3_4_lci_0 fdiff_prob_from3_4_uci_0 fdiff_prob_from3_4_0_2 fdiff_prob_from3_4_lci_0_2 fdiff_prob_from3_4_uci_0_2  {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
.00428,.00722,.00885,.01304
4 est
.4
.7000000000000001
.9
1.3
fdiff_prob_from3_4_0
.4
-.0406871873747903,-.0299615567948069,-.0137823809271426,-.0055464861096174
4 est
-4.100000000000001
-3
-1.4
-.6000000000000001
fdiff_prob_from3_4_lci_0
-4.100000000000001
.0199841329438122,.0398436278583386,.0476349108487975,.0492298849874883
4 est
2
4
4.800000000000001
4.9
fdiff_prob_from3_4_uci_0
2
.00619,.0076900000000001,.00962,.01156
4 est
.6000000000000001
.8
1
1.2
fdiff_prob_from3_4_0_2
.6000000000000001
-.0354943239802692,-.0278434682386617,-.0138204809444161,-.0051825374765298
4 est
-3.5
-2.8
-1.4
-.5
fdiff_prob_from3_4_lci_0_2
-3.5
.0175609364781385,.0369255945074445,.047056481632725,.0508456593792825
4 est
1.8
3.7
4.7
5.100000000000001
fdiff_prob_from3_4_uci_0_2
1.8

. 
. matrix est_diff31 = (ests_fdiff_prob_from3_4_0, ests_fdiff_prob_from3_4_lci_0, ests_fdiff_prob_from3_4_uci_0, ests_fdiff_prob_from3_4_0_2, ests_fdiff_prob_from3_4_lci_0_2, ests_fdiff_prob_from3_4_uci_0_2)

. matrix colnames est_diff31 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff31) using &quot;${pathdata2}diff_probs_res_out_mod_t3.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t3.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff31</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>          .4</td><td>        -4.1</td><td>           2</td><td>          .6</td><td>        -3.5</td><td>         1.8</td></tr>
<tr><td>1_yr        </td><td>          .7</td><td>          -3</td><td>           4</td><td>          .8</td><td>        -2.8</td><td>         3.7</td></tr>
<tr><td>3_yrs       </td><td>          .9</td><td>        -1.4</td><td>         4.8</td><td>           1</td><td>        -1.4</td><td>         4.7</td></tr>
<tr><td>5_yrs       </td><td>         1.3</td><td>         -.6</td><td>         4.9</td><td>         1.2</td><td>         -.5</td><td>         5.1</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h4><a href="#fourth-transition" id="fourth-transition">Fourth transition</a></h4>
<pre><code>. foreach var of varlist fdiff_prob_from3_4_0 fdiff_prob_from3_4_lci_0 fdiff_prob_from3_4_uci_0 fdiff_prob_from3_4_0_2 fdiff_prob_from3_4_lci_0_2 fdiff_prob_from3_4_uci_0_2  {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
.00428,.00722,.00885,.01304
4 est
.4
.7000000000000001
.9
1.3
fdiff_prob_from3_4_0
.4
-.0406871873747903,-.0299615567948069,-.0137823809271426,-.0055464861096174
4 est
-4.100000000000001
-3
-1.4
-.6000000000000001
fdiff_prob_from3_4_lci_0
-4.100000000000001
.0199841329438122,.0398436278583386,.0476349108487975,.0492298849874883
4 est
2
4
4.800000000000001
4.9
fdiff_prob_from3_4_uci_0
2
.00619,.0076900000000001,.00962,.01156
4 est
.6000000000000001
.8
1
1.2
fdiff_prob_from3_4_0_2
.6000000000000001
-.0354943239802692,-.0278434682386617,-.0138204809444161,-.0051825374765298
4 est
-3.5
-2.8
-1.4
-.5
fdiff_prob_from3_4_lci_0_2
-3.5
.0175609364781385,.0369255945074445,.047056481632725,.0508456593792825
4 est
1.8
3.7
4.7
5.100000000000001
fdiff_prob_from3_4_uci_0_2
1.8

. 
. matrix est_diff41 = (ests_fdiff_prob_from3_4_0, ests_fdiff_prob_from3_4_lci_0, ests_fdiff_prob_from3_4_uci_0, ests_fdiff_prob_from3_4_0_2, ests_fdiff_prob_from3_4_lci_0_2, ests_fdiff_prob_from3_4_uci_0_2)

. matrix colnames est_diff41 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff41) using &quot;${pathdata2}diff_probs_res_out_mod_t4.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t4.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff41</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>          .4</td><td>        -4.1</td><td>           2</td><td>          .6</td><td>        -3.5</td><td>         1.8</td></tr>
<tr><td>1_yr        </td><td>          .7</td><td>          -3</td><td>           4</td><td>          .8</td><td>        -2.8</td><td>         3.7</td></tr>
<tr><td>3_yrs       </td><td>          .9</td><td>        -1.4</td><td>         4.8</td><td>           1</td><td>        -1.4</td><td>         4.7</td></tr>
<tr><td>5_yrs       </td><td>         1.3</td><td>         -.6</td><td>         4.9</td><td>         1.2</td><td>         -.5</td><td>         5.1</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h3><a href="#three-years" id="three-years">Three years</a></h3>
<h4><a href="#first-transition" id="first-transition">First transition</a></h4>
<pre><code>. *fdiff_prob_from1_2_3y fdiff_prob_from1_2_lci_3y fdiff_prob_from1_2_uci_3y 
. *fdiff_prob_from1_2_3y  fdiff_prob_from1_2_lci_3y  fdiff_prob_from1_2_uci_3y
. *fdiff_prob_from1_2_lci_3y_2 fdiff_prob_from1_2_uci_3y_2 fdiff_prob_from1_2_3y_2
. 
. foreach var of varlist fdiff_prob_from1_2_3y fdiff_prob_from1_2_lci_3y fdiff_prob_from1_2_uci_3y fdiff_prob_from1_2_3y_2 fdiff_prob_from1_2_lci_3y_2 fdiff_prob_from1_2_uci_3y_2 {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
.03005,.06003,.06572,.06936
4 est
3
6
6.600000000000001
6.9
fdiff_prob_from1_2_3y
3
.0263364329418033,.0502115268997761,.0584990710616745,.0603500162053718
4 est
2.6
5
5.800000000000001
6
fdiff_prob_from1_2_lci_3y
2.6
.0337627376804958,.0698368708934234,.0729340522437397,.0783586822876245
4 est
3.4
7
7.300000000000001
7.800000000000001
fdiff_prob_from1_2_uci_3y
3.4
.01317,.04683,.06433,.0677
4 est
1.3
4.7
6.4
6.800000000000001
fdiff_prob_from1_2_3y_2
1.3
.0110917222860912,.0415887071576113,.0560381008476537,.0601478098508387
4 est
1.1
4.2
5.600000000000001
6
fdiff_prob_from1_2_lci_3y_2
1.1
.0152481639316663,.0520687155074087,.0726130258033289,.0752444399357978
4 est
1.5
5.2
7.300000000000001
7.5
fdiff_prob_from1_2_uci_3y_2
1.5

. 
. matrix est_diff12 = (ests_fdiff_prob_from1_2_3y, ests_fdiff_prob_from1_2_lci_3y, ests_fdiff_prob_from1_2_uci_3y, ests_fdiff_prob_from1_2_3y_2, ests_fdiff_prob_from1_2_lci_3y_2, ests_fdiff_prob_from1_2_uci_3y_2)

. matrix colnames est_diff12 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff12) using &quot;${pathdata2}diff_probs_res_out_mod_t1_3y.html&quot;, replace 
(note: file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t1_3y.html not found)
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t1_3y.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff12</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>           3</td><td>         2.6</td><td>         3.4</td><td>         1.3</td><td>         1.1</td><td>         1.5</td></tr>
<tr><td>1_yr        </td><td>           6</td><td>           5</td><td>           7</td><td>         4.7</td><td>         4.2</td><td>         5.2</td></tr>
<tr><td>3_yrs       </td><td>         6.6</td><td>         5.8</td><td>         7.3</td><td>         6.4</td><td>         5.6</td><td>         7.3</td></tr>
<tr><td>5_yrs       </td><td>         6.9</td><td>           6</td><td>         7.8</td><td>         6.8</td><td>           6</td><td>         7.5</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h4><a href="#second-transition" id="second-transition">Second transition</a></h4>
<pre><code>. foreach var of varlist fdiff_prob_from2_3_3y fdiff_prob_from2_3_lci_3y fdiff_prob_from2_3_uci_3y fdiff_prob_from2_3_3y_2 fdiff_prob_from2_3_lci_3y_2 fdiff_prob_from2_3_uci_3y_2 {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
-.00492,-.00257,-.00037,.00486
4 est
-.5
-.3
0
.5
fdiff_prob_from2_3_3y
-.5
-.0244027583162495,-.0201343168654707,-.0079162199348997,-.0059645084897266
4 est
-2.4
-2
-.8
-.6000000000000001
fdiff_prob_from2_3_lci_3y
-2.4
.0052245316507343,.0145664941691393,.0149959027359852,.0176346334813865
4 est
.5
1.5
1.5
1.8
fdiff_prob_from2_3_uci_3y
.5
-.00345,-.00173,.00148,.0023
4 est
-.3
-.2
.1
.2
fdiff_prob_from2_3_3y_2
-.3
-.0231980463551462,-.0195297702613729,-.0107947963187654,-.0043507898754965
4 est
-2.3
-2
-1.1
-.4
fdiff_prob_from2_3_lci_3y_2
-2.3
.0073106892426056,.0153940075831263,.0160708665702745,.0163007376527103
4 est
.7000000000000001
1.5
1.6
1.6
fdiff_prob_from2_3_uci_3y_2
.7000000000000001

. 
. matrix est_diff22 = (ests_fdiff_prob_from2_3_3y, ests_fdiff_prob_from2_3_lci_3y, ests_fdiff_prob_from2_3_uci_3y, ests_fdiff_prob_from2_3_3y_2, ests_fdiff_prob_from2_3_lci_3y_2, ests_fdiff_prob_from2_3_uci_3y_2)

. matrix colnames est_diff22 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff22) using &quot;${pathdata2}diff_probs_res_out_mod_t2_3y.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t2_3y.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff22</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>         -.5</td><td>        -2.4</td><td>          .5</td><td>         -.3</td><td>        -2.3</td><td>          .7</td></tr>
<tr><td>1_yr        </td><td>         -.3</td><td>          -2</td><td>         1.5</td><td>         -.2</td><td>          -2</td><td>         1.5</td></tr>
<tr><td>3_yrs       </td><td>           0</td><td>         -.8</td><td>         1.5</td><td>          .1</td><td>        -1.1</td><td>         1.6</td></tr>
<tr><td>5_yrs       </td><td>          .5</td><td>         -.6</td><td>         1.8</td><td>          .2</td><td>         -.4</td><td>         1.6</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h4><a href="#third-transition" id="third-transition">Third transition</a></h4>
<pre><code>. foreach var of varlist fdiff_prob_from3_4_3y fdiff_prob_from3_4_lci_3y fdiff_prob_from3_4_uci_3y fdiff_prob_from3_4_3y_2 fdiff_prob_from3_4_lci_3y_2 fdiff_prob_from3_4_uci_3y_2  {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
.00331,.00709,.01269,.01545
4 est
.3
.7000000000000001
1.3
1.5
fdiff_prob_from3_4_3y
.3
-.0391243874049112,-.0238487551072797,-.0091642551520161,-.0034084605559707
4 est
-3.9
-2.4
-.9
-.3
fdiff_prob_from3_4_lci_3y
-3.9
.0175868978234384,.0400455437949596,.0457324701387989,.0491948967073071
4 est
1.8
4
4.600000000000001
4.9
fdiff_prob_from3_4_uci_3y
1.8
.00464,.0116,.01236,.01281
4 est
.5
1.2
1.2
1.3
fdiff_prob_from3_4_3y_2
.5
-.029281235011999,-.0230348321228042,-.0100707224713193,-.0046345167360613
4 est
-2.9
-2.3
-1
-.5
fdiff_prob_from3_4_lci_3y_2
-2.9
.0139137185529631,.0356773153570237,.0477238854010716,.0524424929548392
4 est
1.4
3.6
4.800000000000001
5.2
fdiff_prob_from3_4_uci_3y_2
1.4

. 
. matrix est_diff32 = (ests_fdiff_prob_from3_4_3y, ests_fdiff_prob_from3_4_lci_3y, ests_fdiff_prob_from3_4_uci_3y, ests_fdiff_prob_from3_4_3y_2, ests_fdiff_prob_from3_4_lci_3y_2, ests_fdiff_prob_from3_4_uci_3y_2)

. matrix colnames est_diff32 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff32) using &quot;${pathdata2}diff_probs_res_out_mod_t3_3y.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t3_3y.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff32</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>          .3</td><td>        -3.9</td><td>         1.8</td><td>          .5</td><td>        -2.9</td><td>         1.4</td></tr>
<tr><td>1_yr        </td><td>          .7</td><td>        -2.4</td><td>           4</td><td>         1.2</td><td>        -2.3</td><td>         3.6</td></tr>
<tr><td>3_yrs       </td><td>         1.3</td><td>         -.9</td><td>         4.6</td><td>         1.2</td><td>          -1</td><td>         4.8</td></tr>
<tr><td>5_yrs       </td><td>         1.5</td><td>         -.3</td><td>         4.9</td><td>         1.3</td><td>         -.5</td><td>         5.2</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<h4><a href="#fourth-transition" id="fourth-transition">Fourth transition</a></h4>
<pre><code>. foreach var of varlist fdiff_prob_from4_5_3y fdiff_prob_from4_5_lci_3y fdiff_prob_from4_5_uci_3y fdiff_prob_from4_5_3y_2 fdiff_prob_from4_5_lci_3y_2 fdiff_prob_from4_5_uci_3y_2  {
  2.         scalar variable = &quot;`var'&quot;
  3.         levelsof `var' if inrange(timevar01, .32, .34)|inrange(timevar01, .999, 1.02)|inrange(timevar01, 2.99, 3.02)|inrange(timevar01, 4.999, 5.02), local(mylevs) sep(,)
  4. 
.                                         tokenize &quot;`mylevs'&quot;, parse(&quot; ,&quot;) // `1', `2', ... will hold the elements of the big macro  &quot;`local(mylevs)'&quot;
  5.                                         local done = 0
  6.                                         local i = 0
  7.                                         local count = 0
  8.                                         while !`done' {  
  9.                                            local ++i
 10.                                                 local next = &quot;``i''&quot;
 11.                                                 local done = (&quot;`next'&quot; == &quot;&quot;)
 12.                                            // Include elements that are not the parsing character itself.
.                                                  if (&quot;`next'&quot; != &quot;,&quot;) &amp; (!`done') {
 13.                                                    local ++count
 14.                                                    scalar est_n`count' = &quot;`next'&quot;
 15.                                                 }  
 16.                                         }
 17.                                         //
.                                         di &quot;`count' est&quot;
 18.                                         forval i = 1/`count' {
 19.                                           scalar est_n`i' = round(round(`=scalar(est_n`i')',.001)*100,.1)       
 20.                                           *scalar est_n`i' = &quot;`=scalar(est_n`i')'&quot;
.                                           di &quot;`=scalar(est_n`i')'&quot;
 21.                                         }       
 22.  di &quot;`=scalar(variable)'&quot;
 23.  di &quot;`=scalar(est_n1)'&quot;
 24.  cap noi matrix ests_`var' = (`=scalar(est_n1)'\  `=scalar(est_n2)'\ `=scalar(est_n3)'\ `=scalar(est_n4)')
 25.  matrix colnames ests_`var' = `var'
 26.  matrix rownames ests_`var' = 3_mths 1_yr 3_yrs 5_yrs
 27.  }
.00204,.0051,.00968,.01159
4 est
.2
.5
1
1.2
fdiff_prob_from4_5_3y
.2
-.070980841504933,-.0706279089832679,-.0501545945904443,-.0215069704274232
4 est
-7.100000000000001
-7.100000000000001
-5
-2.2
fdiff_prob_from4_5_lci_3y
-7.100000000000001
.0255847084392722,.0603234700063337,.0898632315299994,.094003082324435
4 est
2.6
6
9
9.4
fdiff_prob_from4_5_uci_3y
2.6
.00195,.00546,.00978,.01246
4 est
.2
.5
1
1.2
fdiff_prob_from4_5_3y_2
.2
-.0696793015144984,-.0684684431336539,-.0463730750364983,-.0197864838567375
4 est
-7
-6.800000000000001
-4.600000000000001
-2
fdiff_prob_from4_5_lci_3y_2
-7
.0236846413544757,.0572637523485556,.0879088523965824,.0944314870901536
4 est
2.4
5.7
8.800000000000001
9.4
fdiff_prob_from4_5_uci_3y_2
2.4

. 
. matrix est_diff42 = (ests_fdiff_prob_from4_5_3y, ests_fdiff_prob_from4_5_lci_3y, ests_fdiff_prob_from4_5_uci_3y, ests_fdiff_prob_from4_5_3y_2, ests_fdiff_prob_from4_5_lci_3y_2, ests_fdiff_prob_from4_5_uci_3y_2)

. matrix colnames est_diff42 = &quot;Completed&quot; &quot;Completed_lo&quot; &quot;Completed_hi&quot; &quot;Not_Completed&quot; &quot;Not_Completed_lo&quot; &quot;Not_Completed_hi&quot;

. 
. esttab matrix(est_diff42) using &quot;${pathdata2}diff_probs_res_out_mod_t4_3y.html&quot;, replace 
(output written to C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/diff_probs_res_out_mod_t4_3y.html)

</code></pre>
<p>The transition probabilities are presented here:</p>
<table border="0" width="*">
<tr><td colspan=7><hr></td></tr>
<tr><td>            </td><td>  est_diff42</td><td>            </td><td>            </td><td>            </td><td>            </td><td>            </td></tr>
<tr><td>            </td><td>   Completed</td><td>Completed_lo</td><td>Completed_hi</td><td>Not_Completed</td><td>Not_Completed_lo</td><td>Not_Completed_hi</td></tr>
<tr><td colspan=7><hr></td></tr>
<tr><td>3_mths      </td><td>          .2</td><td>        -7.1</td><td>         2.6</td><td>          .2</td><td>          -7</td><td>         2.4</td></tr>
<tr><td>1_yr        </td><td>          .5</td><td>        -7.1</td><td>           6</td><td>          .5</td><td>        -6.8</td><td>         5.7</td></tr>
<tr><td>3_yrs       </td><td>           1</td><td>          -5</td><td>           9</td><td>           1</td><td>        -4.6</td><td>         8.8</td></tr>
<tr><td>5_yrs       </td><td>         1.2</td><td>        -2.2</td><td>         9.4</td><td>         1.2</td><td>          -2</td><td>         9.4</td></tr>
<tr><td colspan=7><hr></td></tr>
</table>
<p>=============================================================================</p>
<h2><a href="#pwp-tt" id="pwp-tt">PWP-TT</a></h2>
<p>=============================================================================</p>
<pre><code>. **https://europepmc.org/articles/PMC5805119/bin/qcx015_supp.pdf
. cap qui use &quot;${pathdata2}five_st_msprep_jun.dta&quot;, clear 

. matrix mat_five_states = (.,1,.,.,. \ .,.,2,.,. \.,.,.,3,. \.,.,.,.,4 \.,.,.,.,.)

. msset, id(id) states(Readmission_status Readmission2_status Readmission3_status Readmission4_status) ///
&gt;                 times(Readmission_time Readmission2_time Readmission3_time Readmission4_time) transmatrix(mat_five_states)  //* saqu tipo_de_plan_res_1 para que no se empiece a subdividir

. gen time = _stop - _start

. *originally i set this:
. stset _stop, fail(_status) exit(time .) id(id) enter(_start)

                id:  id
     failure event:  _status != 0 &amp; _status &lt; .
obs. time interval:  (_stop[_n-1], _stop]
 enter on or after:  time _start
 exit on or before:  time .

------------------------------------------------------------------------------
     31,968  total observations
          0  exclusions
------------------------------------------------------------------------------
     31,968  observations remaining, representing
     22,912  subjects
      9,261  failures in multiple-failure-per-subject data
   44771646  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     4,431

. 
. *This is the correct stset for discontinuous risk intervals
. *b)* Prentice, Williams and Peterson Total Time (PWP-TT)
. *****Events are ordered and handled by stratification
. *****The PWP models are conditional models
. *****Everyone is at risk for the first stratum, but only who had
. ********an event in the previous stratum are at risk for the
. ********successive one
. *****It can estimate both overall and event-specific effects
. *****It uses robust standard errors to account for correlation
. ********(variance-corrected method)
. 
. *#Using counting process data structure the PWP-TT model may be fit using:
. *The nohr option can be used with stcox command to request estimated coefficients, instead of hazard ratios. The robust option produces a robust sandwich estimate for covariance matrix. The exit time option defines the time wh
&gt; en a subject stops being at risk. For multivariate survival data, in particular, it needs to be specified as exit(time .) because the default procedure is to remove the subject from the risk set after the first failure.
. *In our case, it is no necessit to specify exit(time .)
. 
. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(5)     =       40.40
Log pseudolikelihood =   -10918.064             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.137168   .0527636     2.77   0.006     1.038316    1.245431
              TD_1 |    .783867   .0424746    -4.49   0.000     .7048865    .8716971
              TD_2 |   .8914284   .0515732    -1.99   0.047      .795867     .998464
              TD_3 |   .8410295   .0450834    -3.23   0.001      .757151    .9342001
              TD_4 |    1.06361   .0574035     1.14   0.253     .9568475    1.182285
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.04930         5.48        1         0.0192
      TD_1        |      0.13758        35.94        1         0.0000
      TD_2        |      0.01568         0.52        1         0.4699
      TD_3        |      0.01623         0.51        1         0.4737
      TD_4        |      0.00509         0.05        1         0.8227
      ------------+---------------------------------------------------
      global test |                     39.88        5         0.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

. 
. *When to use it
. *****When the effects of covariates are different in subsequent events
. *****When the occurrence of the first event increases the likelihood of a recurrence
. *****When there are few recurrent events per subject
. 
. *****PWP-TT models could significantly underestimate the
. **********overall effect if there is no strong biological relationship
. **********between events
. 
. *****Thus, those methods could be proper for only handling a small number of
. **********recurrent events.
. 
. *c)* Prentice, Williams and Peterson Gap Time (PWP-GT)
. *In the PWP-TT model the time scale is time t, from beginning of study
. *In the PWP-GT model the time scale is time t, from the previous event
. 
. *Stratified Cox regr. -- Efron method for ties == efron
</code></pre>
<p>We checked the proportionality of hazards visually</p>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(TD_1 ) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_1, replace)  ///
&gt;         saving(stphplot_trans_1.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_1.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 ) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_2, replace)  ///
&gt;         saving(stphplot_trans_2.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_2.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 ) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_3, replace)  ///
&gt;         saving(stphplot_trans_3.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_3.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 TD_4 ) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_4, replace)  ///
&gt;         saving(stphplot_trans_4.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_4.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_1.gph&quot; &quot;${pathdata}\stphplot_trans_2.gph&quot; &quot;${pathdata}\stphplot_trans_3.gph&quot; &quot;${pathdata}\stphplot_trans_4.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-TT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny)) ///
&gt;         name(_trans_ph_ln_surv_time, replace)  ///
&gt;         saving(_trans_ph_ln_surv_time.gph, replace)
(file _trans_ph_ln_surv_time.gph saved)

</code></pre>
<p><img src="_trans_ph_ln_surv_time.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox  i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(5)     =       40.40
Log pseudolikelihood =   -10918.064             Prob &gt; chi2      =      0.0000

                                           (Std. Err. adjusted for 646 clusters in id)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
---------------------+----------------------------------------------------------------
1.tipo_de_plan_res_1 |   1.137168   .0527636     2.77   0.006     1.038316    1.245431
              1.TD_1 |    .783867   .0424746    -4.49   0.000     .7048865    .8716971
              1.TD_2 |   .8914284   .0515732    -1.99   0.047      .795867     .998464
              1.TD_3 |   .8410295   .0450834    -3.23   0.001      .757151    .9342001
              1.TD_4 |    1.06361   .0574035     1.14   0.253     .9568475    1.182285
--------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(1.tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Modality&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_plan_res, replace)  ///
&gt;         saving(phtest_log_plan_res.gph, replace)
(file phtest_log_plan_res.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_plan_res.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox  i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(5)     =       40.40
Log pseudolikelihood =   -10918.064             Prob &gt; chi2      =      0.0000

                                           (Std. Err. adjusted for 646 clusters in id)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
---------------------+----------------------------------------------------------------
1.tipo_de_plan_res_1 |   1.137168   .0527636     2.77   0.006     1.038316    1.245431
              1.TD_1 |    .783867   .0424746    -4.49   0.000     .7048865    .8716971
              1.TD_2 |   .8914284   .0515732    -1.99   0.047      .795867     .998464
              1.TD_3 |   .8410295   .0450834    -3.23   0.001      .757151    .9342001
              1.TD_4 |    1.06361   .0574035     1.14   0.253     .9568475    1.182285
--------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(1.TD_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_TD_1, replace)  ///
&gt;         saving(phtest_log_TD_1.gph, replace)
(file phtest_log_TD_1.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_TD_1.svg" width="800" ></p>
<p>We included an interaction with time in the type of plan at baseline and in treatment completion at baseline</p>
<pre><code>. *This interaction effect is best added using the tvc() and texp() options
. *https://static-content.springer.com/esm/art%3A10.1186%2F1475-2875-13-293/MediaObjects/12936_2014_3335_MOESM1_ESM.pdf
. stcox i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4 _start , efron nolog robust strata(_trans) tvc(i.tipo_de_plan_res_1 i.TD_1)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id


Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(8)     =       76.74
Log pseudolikelihood =   -10895.237             Prob &gt; chi2      =      0.0000

                                           (Std. Err. adjusted for 646 clusters in id)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
---------------------+----------------------------------------------------------------
main                 |
1.tipo_de_plan_res_1 |   1.280613   .1123619     2.82   0.005     1.078283    1.520907
              1.TD_1 |   .4625426   .0554156    -6.44   0.000     .3657398    .5849668
              1.TD_2 |   .9001604   .0515394    -1.84   0.066     .8046068    1.007062
              1.TD_3 |   .8389973   .0442634    -3.33   0.001     .7565773     .930396
              1.TD_4 |   1.076205   .0568508     1.39   0.164     .9703538    1.193603
              _start |   .9997396   .0000675    -3.85   0.000     .9996073     .999872
---------------------+----------------------------------------------------------------
tvc                  |
1.tipo_de_plan_res_1 |   .9998925   .0000632    -1.70   0.089     .9997686    1.000016
              1.TD_1 |   1.000427   .0000776     5.50   0.000     1.000275    1.000579
--------------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwptt

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

. 
</code></pre>
<p>=============================================================================</p>
<h2><a href="#pwp-gt" id="pwp-gt">PWP-GT</a></h2>
<p>=============================================================================</p>
<pre><code>. *In order to define time to each event from the time of the previous one, 
. *a gap time variable has to be generated, and initial times for all time spans are set to zero.
. use &quot;${pathdata2}five_st_msprep_jun.dta&quot;, clear 

. matrix mat_five_states = (.,1,.,.,. \ .,.,2,.,. \.,.,.,3,. \.,.,.,.,4 \.,.,.,.,.)

. msset, id(id) states(Readmission_status Readmission2_status Readmission3_status Readmission4_status) ///
&gt;                 times(Readmission_time Readmission2_time Readmission3_time Readmission4_time) transmatrix(mat_five_states)  //* saqu tipo_de_plan_res_1 para que no se empiece a subdividir

. gen time = _stop - _start

. gen time0=0

. *stset gap, fail(status) exit(time .) enter(time0)
. *https://www.stata.com/support/faqs/statistics/multiple-failure-time-data/#cond1
. stset time, fail(_status) exit(time .) enter(time0)

     failure event:  _status != 0 &amp; _status &lt; .
obs. time interval:  (0, time]
 enter on or after:  time time0
 exit on or before:  time .

------------------------------------------------------------------------------
     31,968  total observations
          0  exclusions
------------------------------------------------------------------------------
     31,968  observations remaining, representing
      9,261  failures in single-record/single-failure data
   44771646  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     4,431

. 
. cap noi drop sch* sca*
variable sch* not found

. stcox  i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4, efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =        2,584             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(5)     =       44.24
Log pseudolikelihood =   -11798.624             Prob &gt; chi2      =      0.0000

                                           (Std. Err. adjusted for 646 clusters in id)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
---------------------+----------------------------------------------------------------
1.tipo_de_plan_res_1 |   1.129395   .0496617     2.77   0.006     1.036136    1.231048
              1.TD_1 |   .8158183   .0402612    -4.12   0.000      .740604    .8986711
              1.TD_2 |   .8863146    .048851    -2.19   0.029     .7955588    .9874237
              1.TD_3 |   .8196614   .0423381    -3.85   0.000     .7407425    .9069883
              1.TD_4 |   1.046975   .0567703     0.85   0.397     .9414153     1.16437
--------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      0b.tipo_de~1|            .            .        1             .
      1.tipo_de_~1|     -0.03405         2.38        1         0.1229
      0b.TD_1     |            .            .        1             .
      1.TD_1      |      0.08235        11.19        1         0.0008
      0b.TD_2     |            .            .        1             .
      1.TD_2      |      0.02669         1.37        1         0.2413
      0b.TD_3     |            .            .        1             .
      1.TD_3      |      0.04883         4.29        1         0.0383
      0b.TD_4     |            .            .        1             .
      1.TD_4      |      0.01798         0.64        1         0.4242
      ------------+---------------------------------------------------
      global test |                     20.87        5         0.0009
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

. * cluster(id)
</code></pre>
<p>We checked the proportionality of hazards visually</p>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(TD_1 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_12, replace)  ///
&gt;         saving(stphplot_trans_12.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_12.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_22, replace)  ///
&gt;         saving(stphplot_trans_22.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_22.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_32, replace)  ///
&gt;         saving(stphplot_trans_32.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_32.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 TD_4 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_42, replace)  ///
&gt;         saving(stphplot_trans_42.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_42.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_12.gph&quot; &quot;${pathdata}\stphplot_trans_22.gph&quot; &quot;${pathdata}\stphplot_trans_32.gph&quot; &quot;${pathdata}\stphplot_trans_42.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of ln{ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-GT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny)) ///
&gt;         name(_trans_ph_ln_surv_time2, replace)  ///
&gt;         saving(_trans_ph_ln_surv_time2.gph, replace)
(file _trans_ph_ln_surv_time2.gph saved)

</code></pre>
<p><img src="_trans_ph_ln_surv_time2.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox  i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4, efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =        2,584             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(5)     =       44.24
Log pseudolikelihood =   -11798.624             Prob &gt; chi2      =      0.0000

                                           (Std. Err. adjusted for 646 clusters in id)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
---------------------+----------------------------------------------------------------
1.tipo_de_plan_res_1 |   1.129395   .0496617     2.77   0.006     1.036136    1.231048
              1.TD_1 |   .8158183   .0402612    -4.12   0.000      .740604    .8986711
              1.TD_2 |   .8863146    .048851    -2.19   0.029     .7955588    .9874237
              1.TD_3 |   .8196614   .0423381    -3.85   0.000     .7407425    .9069883
              1.TD_4 |   1.046975   .0567703     0.85   0.397     .9414153     1.16437
--------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(1.tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_TD_1_2, replace)  ///
&gt;         saving(phtest_log_TD_1_2.gph, replace)
(file phtest_log_TD_1_2.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_1_2.svg" width="800" ></p>
<pre><code>. qui estread &quot;${pathdata2}parmodels_m3_jun.sters&quot;

. stcox  i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4, efron robust nolog strata(_trans) cluster(id) tvc(TD_1 _start)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .


Stratified Cox regr. -- Efron method for ties

No. of subjects      =        2,584             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(7)     =       68.46
Log pseudolikelihood =   -11782.622             Prob &gt; chi2      =      0.0000

                                           (Std. Err. adjusted for 646 clusters in id)
--------------------------------------------------------------------------------------
                     |               Robust
                  _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
---------------------+----------------------------------------------------------------
main                 |
1.tipo_de_plan_res_1 |   1.144818   .0529169     2.93   0.003     1.045662    1.253376
              1.TD_1 |   .5759215   .0539924    -5.89   0.000     .4792514    .6920909
              1.TD_2 |   .8851279   .0514544    -2.10   0.036     .7898122    .9919464
              1.TD_3 |   .8165877    .044558    -3.71   0.000     .7337635    .9087607
              1.TD_4 |   1.064368    .060642     1.09   0.274     .9519081    1.190115
---------------------+----------------------------------------------------------------
tvc                  |
                TD_1 |   1.000549   .0001206     4.55   0.000     1.000312    1.000785
              _start |          1   7.14e-08     4.32   0.000            1           1
--------------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwpgt

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(appending m3_pwptt_td)
(appending m3_pwptt_td2)
(appending m3_pwpgt)
(appending m3_pwpgt_td)
(appending m3_pwpgt_td2)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

</code></pre>
<p>Saved at= 19:58:49  6 Dec 2021</p>
