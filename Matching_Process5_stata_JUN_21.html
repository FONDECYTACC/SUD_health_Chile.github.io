<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
</head>
<h1><a href="#database-step-5" id="database-step-5">Database (step 5)</a></h1>
<p>Date created: 12 Aug 2021.</p>
<p>Install commands that are unavailable or out of date.</p>
<pre><code>. clear all

. 
. cap noi which predictms
C:\Users\CISS Fondecyt\ado\plus\p\predictms.ado
*! version 4.3.0 14mar2021 MJC

. if _rc==111 {
.         cap noi net install multistate, from(&quot;https://www.mjcrowther.co.uk/code/multistate&quot;) 
.         }

. cap noi which merlin
C:\Users\CISS Fondecyt\ado\plus\m\merlin.ado
*! version 2.0.2 19mar2021 MJC

. if _rc==111 {
.         cap noi net install merlin, from(&quot;https://www.mjcrowther.co.uk/code/merlin/&quot;) 
.         }

. cap noi which sumat
C:\Users\CISS Fondecyt\ado\plus\s\sumat.ado
*! Part of package matrixtools v. 0.25
*! Support: Niels Henrik Bruun, niels.henrik.bruun@gmail.com
*! 2021-01-03 toxl added

. if _rc==111 {
.         cap noi scc install matrixtools
.         }

. cap noi which estwrite
C:\Users\CISS Fondecyt\ado\plus\e\estwrite.ado
*! version 1.2.4 04sep2009
*! version 1.0.1 15may2007 (renamed from -eststo- to -estwrite-; -append- added)
*! version 1.0.0 29apr2005 Ben Jann (ETH Zurich)

. if _rc==111 {
.         cap noi ssc install estwrite
.         }       

.         
. cap noi which scurve_tvc
C:\Users\CISS Fondecyt\ado\plus\s\scurve_tvc.ado

. if _rc==111 {
.         cap noi net install st0458.pkg
.         }

.         
</code></pre>
<p>We need to obtain the file and the work folder.</p>
<pre><code>. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;/volumes/sdrive/data//&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;/volumes/sdrive/data//&quot;
.         global pathdata &quot;/volumes/sdrive/data//&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;E:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;E:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata &quot;E:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;E:/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;G:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;G:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata &quot;G:\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;G:/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

.                 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)&quot;
C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)
.         global pathdata &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
Location= C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags; Date: 12 Aug 2021, considering an OS Windows for the user: CISS Fondecyt
. }

. else display &quot;This file does not exist&quot;

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;C:\Users\andre\Desktop\_mult_state_ags\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;C:\Users\andre\Desktop\_mult_state_ags&quot;
.         global pathdata &quot;C:\Users\andre\Desktop\_mult_state_ags&quot;
.         global pathdata2 &quot;C:/Users/andre/Desktop/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
. }

. else display &quot;This file does not exist&quot;
This file does not exist

. 
. mata : st_numscalar(&quot;OK&quot;, direxists(&quot;C:\Users\CISS Fondecyt\OneDrive\Documentos\&quot;))

. if scalar(OK) == 1 {
.         cap noi cd &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags
.         global pathdata &quot;C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags&quot;
.         global pathdata2 &quot;C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/&quot;
.         di &quot;Location= ${pathdata}; Date: `c(current_date)', considering an OS `c(os)' for the user: `c(username)'&quot;
Location= C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)\_mult_state_ags; Date: 12 Aug 2021, considering an OS Windows for the user: CISS Fondecyt
. }

. else display &quot;This file does not exist&quot;

. 
</code></pre>
<p>Path data= C:\Users\CISS Fondecyt\Mi unidad\Alvacast\SISTRAT 2019 (github)_mult_state_ags;</p>
<p>Timestamp: 12 Aug 2021, considering that is a Windows OS for the username: CISS Fondecyt</p>
<p>The file is located and named as: C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/archivo_multiestado3_jun.dta</p>
<p>Defined transition matrix.</p>
<p>=============================================================================</p>
<h2><a href="#figures-of-differences-with-treatment-completion-at-baseline" id="figures-of-differences-with-treatment-completion-at-baseline">Figures of Differences, with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. *Assessing and relaxing the Markov assumption in the illness-death model
. *Jonathan Broomfield1, Caroline E. Weibull2, and Michael J. Crowther
. *fratio_from1_2_lci_0)(fratio_from1_2_uci_0)(fratio_from1_2_0)(fdiff_prob_from1_2_lci_0)(fdiff_prob_from1_2_uci_0)(fdiff_prob_from1_2_0)  
. tw      (rarea fdiff_prob_from1_2_lci_0_2 fdiff_prob_from1_2_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from1_2_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities&quot;) name(diff_mod12_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod12_tc.gph, replace)
(file diff_mod12_tc.gph saved)

. *graph export prob_trans_12.gph, replace
</code></pre>
<p><img src="DIFF1_2_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from2_3_lci_0_2 fdiff_prob_from2_3_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from2_3_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities&quot;) name(diff_mod23_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod23_tc.gph, replace) 
(file diff_mod23_tc.gph saved)

. *graph export prob_trans_23.gph, replace
</code></pre>
<p><img src="DIFF2_3_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from3_4_lci_0_2 fdiff_prob_from3_4_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from3_4_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities&quot;) name(diff_mod34_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod34_tc.gph, replace)
(file diff_mod34_tc.gph saved)

. *graph export prob_trans_34.gph, replace
</code></pre>
<p><img src="DIFF3_4_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from4_5_lci_0_2 fdiff_prob_from4_5_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from4_5_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities&quot;) name(diff_mod45_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod45_tc.gph, replace)
(file diff_mod45_tc.gph saved)

. *graph export prob_trans_45.gph, replace
</code></pre>
<p><img src="DIFF4_5_jun_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#figures-of-differences-3-years-with-treatment-completion-at-baseline" id="figures-of-differences-3-years-with-treatment-completion-at-baseline">Figures of Differences (3 years), with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. *Assessing and relaxing the Markov assumption in the illness-death model
. *Jonathan Broomfield1, Caroline E. Weibull2, and Michael J. Crowther
. *fratio_from1_2_lci_0)(fratio_from1_2_uci_0)(fratio_from1_2_0)(fdiff_prob_from1_2_lci_0)(fdiff_prob_from1_2_uci_0)(fdiff_prob_from1_2_0)  
. tw      (rarea fdiff_prob_from1_2_lci_3y_2 fdiff_prob_from1_2_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from1_2_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years&quot;) name(diff_mod12_3y_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod12_3y_tc.gph, replace)
(file diff_mod12_3y_tc.gph saved)

. *graph export prob_trans_12.gph, replace
</code></pre>
<p><img src="DIFF1_2_3y_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from2_3_lci_3y_2 fdiff_prob_from2_3_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from2_3_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years&quot;) name(diff_mod23_3y_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod23_3y_tc.gph, replace)
(file diff_mod23_3y_tc.gph saved)

. *graph export prob_trans_23.gph, replace
</code></pre>
<p><img src="DIFF2_3_3y_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from3_4_lci_3y_2 fdiff_prob_from3_4_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from3_4_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years&quot;) name(diff_mod34_3y_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod34_3y_tc.gph, replace)
(file diff_mod34_3y_tc.gph saved)

. *graph export prob_trans_34.gph, replace
</code></pre>
<p><img src="DIFF3_4_3y_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from4_5_lci_3y_2 fdiff_prob_from4_5_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from4_5_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years&quot;) name(diff_mod45_3y_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod45_3y_tc.gph, replace)
(file diff_mod45_3y_tc.gph saved)

. *graph export prob_trans_45.gph, replace
</code></pre>
<p><img src="DIFF4_5_3y_jun_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#figures-of-ratio-with-treatment-completion-at-baseline" id="figures-of-ratio-with-treatment-completion-at-baseline">Figures of Ratio, with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. tw      (rarea fratio_from1_2_lci_0_2 fratio_from1_2_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from1_2_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)9, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models12_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models12_tc.gph, replace) 
(file ratio_models12_tc.gph saved)

</code></pre>
<p><img src="RATIO1_2_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from2_3_lci_0_2 fratio_from2_3_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from2_3_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.25)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models23_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models23_tc.gph, replace)   
(file ratio_models23_tc.gph saved)

</code></pre>
<p><img src="RATIO2_3_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from3_4_lci_0_2 fratio_from3_4_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from3_4_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models34_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models34_tc.gph, replace)    
(file ratio_models34_tc.gph saved)

</code></pre>
<p><img src="RATIO3_4_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from4_5_lci_0_2 fratio_from4_5_uci_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from4_5_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models45_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models45_tc.gph, replace)   
(file ratio_models45_tc.gph saved)

</code></pre>
<p><img src="RATIO4_5_jun_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#figures-of-ratio-3-years-with-treatment-completion-at-baseline" id="figures-of-ratio-3-years-with-treatment-completion-at-baseline">Figures of Ratio (3 years), with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. tw      (rarea fratio_from1_2_lci_3y_2 fratio_from1_2_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from1_2_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)9, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models12_3y_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models12_3y_tc.gph, replace)    
(file ratio_models12_3y_tc.gph saved)

</code></pre>
<p><img src="RATIO1_2_3y_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from2_3_lci_3y_2 fratio_from2_3_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from2_3_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models23_3y_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models23_3y_tc.gph, replace) 
(file ratio_models23_3y_tc.gph saved)

</code></pre>
<p><img src="RATIO2_3_3y_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from3_4_lci_3y_2 fratio_from3_4_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from3_4_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models34_3y_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models34_3y_tc.gph, replace) 
(file ratio_models34_3y_tc.gph saved)

</code></pre>
<p><img src="RATIO3_4_3y_jun_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from4_5_lci_3y_2 fratio_from4_5_uci_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from4_5_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities&quot;) name(ratio_models45_3y_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models45_3y_tc.gph, replace) 
(file ratio_models45_3y_tc.gph saved)

</code></pre>
<p><img src="RATIO4_5_3y_jun_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#rp-figures-of-differences-with-treatment-completion-at-baseline" id="rp-figures-of-differences-with-treatment-completion-at-baseline">(RP) Figures of Differences, with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. *Assessing and relaxing the Markov assumption in the illness-death model
. *Jonathan Broomfield1, Caroline E. Weibull2, and Michael J. Crowther
. *fratio_from1_2_lci_0)(fratio_from1_2_uci_0)(fratio_from1_2_0)(fdiff_prob_from1_2_lci_0)(fdiff_prob_from1_2_uci_0)(fdiff_prob_from1_2_0)  
. tw      (rarea fdiff_prob_from1_2_lci_rp_0_2 fdiff_prob_from1_2_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from1_2_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities (RP)&quot;) name(diff_mod12_rp_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod12_rp_tc.gph, replace)
(file diff_mod12_rp_tc.gph saved)

. *graph export prob_trans_12.gph, replace
</code></pre>
<p><img src="DIFF1_2_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from2_3_lci_rp_0_2 fdiff_prob_from2_3_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from2_3_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities (RP)&quot;) name(diff_mod23_rp_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod23_rp_tc.gph, replace)
(file diff_mod23_rp_tc.gph saved)

. *graph export prob_trans_23.gph, replace
</code></pre>
<p><img src="DIFF2_3_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from3_4_lci_rp_0_2 fdiff_prob_from3_4_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from3_4_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities (RP)&quot;) name(diff_mod34_rp_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod34_rp_tc.gph, replace)
(file diff_mod34_rp_tc.gph saved)

. *graph export prob_trans_34.gph, replace
</code></pre>
<p><img src="DIFF3_4_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from4_5_lci_rp_0_2 fdiff_prob_from4_5_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from4_5_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities (RP)&quot;) name(diff_mod45_rp_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod45_rp_tc.gph, replace)
(file diff_mod45_rp_tc.gph saved)

. *graph export prob_trans_45.gph, replace
</code></pre>
<p><img src="DIFF4_5_jun_rp_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#rp-figures-of-differences-3-years-with-treatment-completion-at-baseline" id="rp-figures-of-differences-3-years-with-treatment-completion-at-baseline">(RP) Figures of Differences (3 years), with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. *Assessing and relaxing the Markov assumption in the illness-death model
. *Jonathan Broomfield1, Caroline E. Weibull2, and Michael J. Crowther
. *fratio_from1_2_lci_0)(fratio_from1_2_uci_0)(fratio_from1_2_0)(fdiff_prob_from1_2_lci_0)(fdiff_prob_from1_2_uci_0)(fdiff_prob_from1_2_0)  
. tw      (rarea fdiff_prob_from1_2_lci_rp_3y_2 fdiff_prob_from1_2_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from1_2_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years (RP)&quot;) name(diff_mod12_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod12_3y_rp_tc.gph, replace)
(file diff_mod12_3y_rp_tc.gph saved)

. *graph export prob_trans_12.gph, replace
</code></pre>
<p><img src="DIFF1_2_3y_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from2_3_lci_rp_3y_2 fdiff_prob_from2_3_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from2_3_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years (RP)&quot;) name(diff_mod23_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod23_3y_rp_tc.gph, replace)
(file diff_mod23_3y_rp_tc.gph saved)

. *graph export prob_trans_23.gph, replace
</code></pre>
<p><img src="DIFF2_3_3y_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from3_4_lci_rp_3y_2 fdiff_prob_from3_4_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from3_4_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years (RP)&quot;) name(diff_mod34_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod34_3y_rp_tc.gph, replace)
(file diff_mod34_3y_rp_tc.gph saved)

. *graph export prob_trans_34.gph, replace
</code></pre>
<p><img src="DIFF3_4_3y_rp_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fdiff_prob_from4_5_lci_rp_3y_2 fdiff_prob_from4_5_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fdiff_prob_from4_5_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(0, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Difference in Probabilities) xlab(0(.3)5,labsize(small)) ylab(-.25(.05).25, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Difference in Probabilities at 3 years (RP)&quot;) name(diff_mod45_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(diff_mod45_3y_rp_tc.gph, replace)
(file diff_mod45_3y_rp_tc.gph saved)

. *graph export prob_trans_45.gph, replace
</code></pre>
<p><img src="DIFF4_5_3y_jun_rp_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#rp-figures-of-ratio-with-treatment-completion-at-baseline" id="rp-figures-of-ratio-with-treatment-completion-at-baseline">(RP) Figures of Ratio, with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. tw      (rarea fratio_from1_2_lci_rp_0_2 fratio_from1_2_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from1_2_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)3, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models12_rp_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models12_rp_tc.gph, replace)
(file ratio_models12_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO1_2_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from2_3_lci_rp_0_2 fratio_from2_3_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from2_3_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.25)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models23_rp_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models23_rp_tc.gph, replace)  
(file ratio_models23_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO2_3_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from3_4_lci_rp_0_2 fratio_from3_4_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from3_4_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models34_rp_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models34_rp_tc.gph, replace) 
(file ratio_models34_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO3_4_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from4_5_lci_rp_0_2 fratio_from4_5_uci_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from4_5_rp_0_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models45_rp_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models45_rp_tc.gph, replace) 
(file ratio_models45_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO4_5_jun_rp_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#rp-figures-of-ratio-3-years-with-treatment-completion-at-baseline" id="rp-figures-of-ratio-3-years-with-treatment-completion-at-baseline">(RP) Figures of Ratio (3 years), with Treatment Completion at Baseline</a></h2>
<p>=============================================================================</p>
<pre><code>. tw      (rarea fratio_from1_2_lci_rp_3y_2 fratio_from1_2_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from1_2_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models12_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from Admission to Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models12_3y_rp_tc.gph, replace)  
(file ratio_models12_3y_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO1_2_3y_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from2_3_lci_rp_3y_2 fratio_from2_3_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from2_3_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models23_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from Readmission to 2nd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models23_3y_rp_tc.gph, replace)   
(file ratio_models23_3y_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO2_3_3y_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from3_4_lci_rp_3y_2 fratio_from3_4_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from3_4_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models34_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from 2nd Readmission to 3rd Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models34_3y_rp_tc.gph, replace)   
(file ratio_models34_3y_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO3_4_3y_jun_rp_tc.svg" width="800" ></p>
<pre><code>. tw      (rarea fratio_from4_5_lci_rp_3y_2 fratio_from4_5_uci_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(gs8) color(gs8%65)) ///
&gt;         (line fratio_from4_5_rp_3y_2 timevar01, sort connect(stairstep stairstep) lcolor(black)), ///
&gt;         yline(1, lcolor(navy)) ///
&gt;  xtitle(Time (years)) ytitle(Ratio in Probabilities) xlab(0(.3)5,labsize(small)) ylab(0(.5)2, /// *730
&gt;  angle(h) format(%4.2f)) legend(order(1 &quot;CI95%&quot; 2 &quot;Difference&quot;) pos(11) ring(0) c(1)) ///
&gt;  title(&quot;Ratio in Probabilities (RP)&quot;) name(ratio_models45_3y_rp_tc, replace) ///
&gt;  subtitle(&quot;from 3rd Readmission to 4th Readmission&quot;)  /// * text(0.2 4 &quot;Outpatient&quot;, size(small)) /// * text(0.29 4 &quot;Residential&quot;, size(small)) ///
&gt;  graphregion(col(white)) saving(ratio_models45_3y_rp_tc.gph, replace)   
(file ratio_models45_3y_rp_tc.gph saved)

</code></pre>
<p><img src="RATIO4_5_3y_jun_rp_tc.svg" width="800" ></p>
<p>=============================================================================</p>
<h2><a href="#analysis-by-transitions" id="analysis-by-transitions">Analysis by transitions</a></h2>
<p>=============================================================================</p>
<pre><code>. graph combine &quot;${pathdata}\diff_mod12.gph&quot; &quot;${pathdata}\diff_mod12rp.gph&quot; &quot;${pathdata}\diff_mod12_3y.gph&quot; &quot;${pathdata}\diff_mod12_3y.gph&quot; ///
&gt; &quot;${pathdata}\diff_mod12_tc.gph&quot; &quot;${pathdata}\diff_mod12_rp_tc.gph&quot; &quot;${pathdata}\diff_mod12_3y_tc.gph&quot; &quot;${pathdata}\diff_mod12_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the First Transition&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_1st_transition.png&quot;, as(png) replace width(2000) height(1000)
(file _1st_transition.png written in PNG format)

. graph export &quot;_1st_transition.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _1st_transition.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb1_diff.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\diff_mod23.gph&quot; &quot;${pathdata}\diff_mod23rp.gph&quot; &quot;${pathdata}\diff_mod23_3y.gph&quot; &quot;${pathdata}\diff_mod23_3y.gph&quot; ///
&gt; &quot;${pathdata}\diff_mod23_tc.gph&quot; &quot;${pathdata}\diff_mod23_rp_tc.gph&quot; &quot;${pathdata}\diff_mod23_3y_tc.gph&quot; &quot;${pathdata}\diff_mod23_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Second Transition&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_2nd_transition.png&quot;, as(png) replace width(2000) height(1000)
(file _2nd_transition.png written in PNG format)

. graph export &quot;_2nd_transition.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _2nd_transition.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb2_diff.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\diff_mod34.gph&quot; &quot;${pathdata}\diff_mod34rp.gph&quot; &quot;${pathdata}\diff_mod34_3y.gph&quot; &quot;${pathdata}\diff_mod34_3y.gph&quot; ///
&gt; &quot;${pathdata}\diff_mod34_tc.gph&quot; &quot;${pathdata}\diff_mod34_rp_tc.gph&quot; &quot;${pathdata}\diff_mod34_3y_tc.gph&quot; &quot;${pathdata}\diff_mod34_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Third Transition&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_3rd_transition.png&quot;, as(png) replace width(2000) height(1000)
(file _3rd_transition.png written in PNG format)

. graph export &quot;_3rd_transition.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _3rd_transition.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb3_diff.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\diff_mod45.gph&quot; &quot;${pathdata}\diff_mod45rp.gph&quot; &quot;${pathdata}\diff_mod45_3y.gph&quot; &quot;${pathdata}\diff_mod45_3y.gph&quot; ///
&gt; &quot;${pathdata}\diff_mod45_tc.gph&quot; &quot;${pathdata}\diff_mod45_rp_tc.gph&quot; &quot;${pathdata}\diff_mod45_3y_tc.gph&quot; &quot;${pathdata}\diff_mod45_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Fourth Transition&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_4th_transition.png&quot;, as(png) replace width(2000) height(1000)
(file _4th_transition.png written in PNG format)

. graph export &quot;_4th_transition.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _4th_transition.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb4_diff.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\ratio_models12.gph&quot; &quot;${pathdata}\ratio_models12rp.gph&quot; &quot;${pathdata}\ratio_models12_3y.gph&quot; &quot;${pathdata}\ratio_models12_3y.gph&quot; ///
&gt; &quot;${pathdata}\ratio_models12_tc.gph&quot; &quot;${pathdata}\ratio_models12_rp_tc.gph&quot; &quot;${pathdata}\ratio_models12_3y_tc.gph&quot; &quot;${pathdata}\ratio_models12_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the First Transition (Ratio)&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_1st_transition_ratio.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _1st_transition_ratio.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb1_ratio.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\ratio_models23.gph&quot; &quot;${pathdata}\ratio_models23rp.gph&quot; &quot;${pathdata}\ratio_models23_3y.gph&quot; &quot;${pathdata}\ratio_models23_3y.gph&quot; ///
&gt; &quot;${pathdata}\ratio_models23_tc.gph&quot; &quot;${pathdata}\ratio_models23_rp_tc.gph&quot; &quot;${pathdata}\ratio_models23_3y_tc.gph&quot; &quot;${pathdata}\ratio_models23_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Second Transition (Ratio)&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_2nd_transition_ratio.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _2nd_transition_ratio.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb2_ratio.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\ratio_models34.gph&quot; &quot;${pathdata}\ratio_models34rp.gph&quot; &quot;${pathdata}\ratio_models34_3y.gph&quot; &quot;${pathdata}\ratio_models34_3y.gph&quot; ///
&gt; &quot;${pathdata}\ratio_models34_tc.gph&quot; &quot;${pathdata}\ratio_models34_rp_tc.gph&quot; &quot;${pathdata}\ratio_models34_3y_tc.gph&quot; &quot;${pathdata}\ratio_models34_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Third Transition (Ratio)&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_3rd_transition_ratio.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _3rd_transition_ratio.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb3_ratio.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\ratio_models45.gph&quot; &quot;${pathdata}\ratio_models45rp.gph&quot; &quot;${pathdata}\ratio_models45_3y.gph&quot; &quot;${pathdata}\ratio_models45_3y.gph&quot; ///
&gt; &quot;${pathdata}\ratio_models45_tc.gph&quot; &quot;${pathdata}\ratio_models45_rp_tc.gph&quot; &quot;${pathdata}\ratio_models45_3y_tc.gph&quot; &quot;${pathdata}\ratio_models45_3y_rp_tc.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Fourth Transition (Ratio)&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: Treatment completion at baseline(last four)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_4th_transition_ratio.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _4th_transition_ratio.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb4_ratio.svg" width="800" ></p>
<p>Two plots of the four transitions, compared to LMAJ estimates (arrival at 0 days &amp; no treatment completion at baseline).</p>
<pre><code>. graph combine &quot;${pathdata}\trans_models12.gph&quot; &quot;${pathdata}\trans_models23.gph&quot; &quot;${pathdata}\trans_models34.gph&quot; &quot;${pathdata}\trans_models45.gph&quot; ///
&gt; &quot;${pathdata}\trans_models12rp.gph&quot; &quot;${pathdata}\trans_models23rp.gph&quot; &quot;${pathdata}\trans_models34rp.gph&quot; &quot;${pathdata}\trans_models45rp.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Transition Probabilities&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: in each transition}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. 
. gr_edit .plotregion1.graph2.legend.DragBy 19 -10

. gr_edit .plotregion1.graph3.legend.DragBy 19 -10

. gr_edit .plotregion1.graph6.legend.DragBy 19 -10

. gr_edit .plotregion1.graph7.legend.DragBy 19 -10

. *gr_edit .plotregion1.graph2.move legend above 7 5
. graph export &quot;_probs_comb2.png&quot;, as(png) replace width(2000) height(1000)
(file _probs_comb2.png written in PNG format)

. graph export &quot;_probs_comb2.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _probs_comb2.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb_probs.svg" width="800" ></p>
<pre><code>. graph combine &quot;${pathdata}\los_models12.gph&quot; &quot;${pathdata}\los_models23.gph&quot; &quot;${pathdata}\los_models34.gph&quot; &quot;${pathdata}\los_models45.gph&quot; ///
&gt; &quot;${pathdata}\los_models12_rp.gph&quot; &quot;${pathdata}\los_models23_rp.gph&quot; &quot;${pathdata}\los_models34_rp.gph&quot; &quot;${pathdata}\los_models45_rp.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.5) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of the Lengths of Stay&quot;, size(medium)) cols(4) ///
&gt; subtitle(&quot;{it: in each transition}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_los_comb.png&quot;, as(png) replace width(2000) height(1000)
(file _los_comb.png written in PNG format)

. graph export &quot;_los_comb.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _los_comb.pdf written in PDF format)

. *graph export &quot;_Appendix2_Graph_Mean_SE_g32.svg&quot;, as(svg) replace height(20000) fontface (Helvetica)
</code></pre>
<p><img src="comb_los.svg" width="800" ></p>
<pre><code>.         cap qui save &quot;${pathdata2}archivo_multiestado4_jun.dta&quot;,all replace emptyok

.         * estimates use &quot;${pathdata2}parmodels.ster&quot;
</code></pre>
<p>=============================================================================</p>
<h2><a href="#pwp-tt" id="pwp-tt">PWP-TT</a></h2>
<p>=============================================================================</p>
<pre><code>. use &quot;${pathdata2}five_st_msprep_jun.dta&quot;, clear 

. matrix mat_five_states = (.,1,.,.,. \ .,.,2,.,. \.,.,.,3,. \.,.,.,.,4 \.,.,.,.,.)

. msset, id(id) states(Readmission_status Readmission2_status Readmission3_status Readmission4_status) ///
&gt;                 times(Readmission_time Readmission2_time Readmission3_time Readmission4_time) transmatrix(mat_five_states)  //* saqué tipo_de_plan_res_1 para que no se empiece a subdividir

. gen time = _stop - _start

. *originally i set this:
. stset _stop, fail(_status) exit(time .) id(id) enter(_start)

                id:  id
     failure event:  _status != 0 &amp; _status &lt; .
obs. time interval:  (_stop[_n-1], _stop]
 enter on or after:  time _start
 exit on or before:  time .

------------------------------------------------------------------------------
     31,968  total observations
          0  exclusions
------------------------------------------------------------------------------
     31,968  observations remaining, representing
     22,912  subjects
      9,261  failures in multiple-failure-per-subject data
   44771646  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     4,431

. 
. *This is the correct stset for discontinuous risk intervals
. *b)* Prentice, Williams and Peterson Total Time (PWP-TT)
. *****Events are ordered and handled by stratification
. *****The PWP models are conditional models
. *****Everyone is at risk for the first stratum, but only who had
. ********an event in the previous stratum are at risk for the
. ********successive one
. *****It can estimate both overall and event-specific effects
. *****It uses robust standard errors to account for correlation
. ********(variance-corrected method)
. 
. *#Using counting process data structure the PWP-TT model may be fit using:
. *The nohr option can be used with stcox command to request estimated coefficients, instead of hazard ratios. The robust option produces a robust sandwich estimate for covariance matrix. The exit time option defines the time when a subject stops being
&gt;  at risk. For multivariate survival data, in particular, it needs to be specified as exit(time .) because the default procedure is to remove the subject from the risk set after the first failure.
. *In our case, it is no necessit to specify exit(time .)
. 
. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4 _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(6)     =       47.20
Log pseudolikelihood =   -10913.823             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.127642   .0511731     2.65   0.008     1.031676    1.232535
              TD_1 |   .8034109   .0430405    -4.09   0.000     .7233309    .8923567
              TD_2 |   .8942041   .0510929    -1.96   0.050     .7994675    1.000167
              TD_3 |   .8371598    .044489    -3.34   0.001     .7543505    .9290596
              TD_4 |   1.059877   .0565679     1.09   0.276     .9546075    1.176754
            _start |   .9998009   .0000673    -2.96   0.003     .9996691    .9999327
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.05706         7.12        1         0.0076
      TD_1        |      0.13954        35.62        1         0.0000
      TD_2        |      0.01459         0.44        1         0.5067
      TD_3        |      0.01844         0.65        1         0.4196
      TD_4        |      0.00346         0.02        1         0.8799
      _start      |      0.03446         2.16        1         0.1413
      ------------+---------------------------------------------------
      global test |                     44.70        6         0.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

. 
. *When to use it
. *****When the effects of covariates are different in subsequent events
. *****When the occurrence of the first event increases the likelihood of a recurrence
. *****When there are few recurrent events per subject
. 
. *****PWP-TT models could significantly underestimate the
. **********overall effect if there is no strong biological relationship
. **********between events
. 
. *****Thus, those methods could be proper for only handling a small number of
. **********recurrent events.
. 
. *c)* Prentice, Williams and Peterson Gap Time (PWP-GT)
. *In the PWP-TT model the time scale is time t, from beginning of study
. *In the PWP-GT model the time scale is time t, from the previous event
. 
. *Stratified Cox regr. -- Efron method for ties == efron
</code></pre>
<p>We checked the proportionality of hazards visually</p>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(TD_1 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_1, replace)  ///
&gt;         saving(stphplot_trans_1.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_1.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_2, replace)  ///
&gt;         saving(stphplot_trans_2.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_2.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_3, replace)  ///
&gt;         saving(stphplot_trans_3.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_3.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 TD_4 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_4, replace)  ///
&gt;         saving(stphplot_trans_4.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_4.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_1.gph&quot; &quot;${pathdata}\stphplot_trans_2.gph&quot; &quot;${pathdata}\stphplot_trans_3.gph&quot; &quot;${pathdata}\stphplot_trans_4.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-TT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_trans_ph_ln_surv_time.png&quot;, as(png) replace width(2000) height(1000)
(file _trans_ph_ln_surv_time.png written in PNG format)

. graph export &quot;_trans_ph_ln_surv_time.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _trans_ph_ln_surv_time.pdf written in PDF format)

</code></pre>
<p><img src="_trans_ph_ln_surv_time.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4 _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(6)     =       47.20
Log pseudolikelihood =   -10913.823             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.127642   .0511731     2.65   0.008     1.031676    1.232535
              TD_1 |   .8034109   .0430405    -4.09   0.000     .7233309    .8923567
              TD_2 |   .8942041   .0510929    -1.96   0.050     .7994675    1.000167
              TD_3 |   .8371598    .044489    -3.34   0.001     .7543505    .9290596
              TD_4 |   1.059877   .0565679     1.09   0.276     .9546075    1.176754
            _start |   .9998009   .0000673    -2.96   0.003     .9996691    .9999327
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Modality&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_plan_res, replace)  ///
&gt;         saving(phtest_log_plan_res.gph, replace)
(file phtest_log_plan_res.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_plan_res.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4 _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(6)     =       47.20
Log pseudolikelihood =   -10913.823             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.127642   .0511731     2.65   0.008     1.031676    1.232535
              TD_1 |   .8034109   .0430405    -4.09   0.000     .7233309    .8923567
              TD_2 |   .8942041   .0510929    -1.96   0.050     .7994675    1.000167
              TD_3 |   .8371598    .044489    -3.34   0.001     .7543505    .9290596
              TD_4 |   1.059877   .0565679     1.09   0.276     .9546075    1.176754
            _start |   .9998009   .0000673    -2.96   0.003     .9996691    .9999327
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(TD_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_TD_1, replace)  ///
&gt;         saving(phtest_log_TD_1.gph, replace)
(file phtest_log_TD_1.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_TD_1.svg" width="800" ></p>
<p>We included an interaction with time in the type of plan at baseline and in treatment completion at baseline</p>
<pre><code>. *This interaction effect is best added using the tvc() and texp() options
. *https://static-content.springer.com/esm/art%3A10.1186%2F1475-2875-13-293/MediaObjects/12936_2014_3335_MOESM1_ESM.pdf
. xi: stcox i.tipo_de_plan_res_1 i.TD_1 i.TD_2 i.TD_3 i.TD_4 _start , efron nolog robust strata(_trans) tvc(i.tipo_de_plan_res_1 i.TD_1)
i.tipo_de_pla~1   _Itipo_de_p_0-1     (naturally coded; _Itipo_de_p_0 omitted)
i.TD_1            _ITD_1_0-1          (naturally coded; _ITD_1_0 omitted)
i.TD_2            _ITD_2_0-1          (naturally coded; _ITD_2_0 omitted)
i.TD_3            _ITD_3_0-1          (naturally coded; _ITD_3_0 omitted)
i.TD_4            _ITD_4_0-1          (naturally coded; _ITD_4_0 omitted)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id


Stratified Cox regr. -- Efron method for ties

No. of subjects      =          646             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(8)     =       76.74
Log pseudolikelihood =   -10895.237             Prob &gt; chi2      =      0.0000

                                    (Std. Err. adjusted for 646 clusters in id)
-------------------------------------------------------------------------------
              |               Robust
           _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
main          |
_Itipo_de_p_1 |   1.280613   .1123619     2.82   0.005     1.078283    1.520907
     _ITD_1_1 |   .4625426   .0554156    -6.44   0.000     .3657398    .5849668
     _ITD_2_1 |   .9001604   .0515394    -1.84   0.066     .8046068    1.007062
     _ITD_3_1 |   .8389973   .0442634    -3.33   0.001     .7565773     .930396
     _ITD_4_1 |   1.076205   .0568508     1.39   0.164     .9703538    1.193603
       _start |   .9997396   .0000675    -3.85   0.000     .9996073     .999872
--------------+----------------------------------------------------------------
tvc           |
_Itipo_de_p_1 |   .9998925   .0000632    -1.70   0.089     .9997686    1.000016
     _ITD_1_1 |   1.000427   .0000776     5.50   0.000     1.000275    1.000579
-------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwptt

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;
file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters already exists
r(602);

. 
</code></pre>
<h3><a href="#changed-how-covariates-were-coded" id="changed-how-covariates-were-coded">changed how covariates were coded</a></h3>
<pre><code>. ******************************************************************************
. foreach num of numlist 1/4 {
  2. gen td_`num'=TD_`num'
  3. replace td_`num'=0 if _from&gt;`num'|_from&lt;`num'   
  4. }
(2,110 real changes made)
(16,514 missing values generated)
(18,482 real changes made)
(25,286 missing values generated)
(26,201 real changes made)
(29,384 missing values generated)
(29,732 real changes made)

. * similares a los TD.1 en stata que son transition specific covariates. 
. 
. cap noi drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      336.11
Log pseudolikelihood =   -82411.196             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362671   .0301261    14.00   0.000     1.304886    1.423015
              td_1 |   .8255772   .0236846    -6.68   0.000     .7804371    .8733281
              td_2 |    .818299   .0436349    -3.76   0.000     .7370936    .9084507
              td_3 |   .7989705   .0762864    -2.35   0.019     .6626089    .9633947
              td_4 |   .9470699   .1527693    -0.34   0.736     .6903622    1.299233
            _start |   1.000428   .0000419    10.20   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.12771       162.43        1         0.0000
      td_1        |      0.16214       228.65        1         0.0000
      td_2        |      0.03662        11.97        1         0.0005
      td_3        |      0.01852         2.92        1         0.0874
      td_4        |      0.01313         1.39        1         0.2388
      _start      |      0.00760         0.41        1         0.5227
      ------------+---------------------------------------------------
      global test |                    375.68        6         0.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

</code></pre>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(td_1 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_1td, replace)  ///
&gt;         saving(stphplot_trans_1td.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_1td.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(td_1 td_2 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_2td, replace)  ///
&gt;         saving(stphplot_trans_2td.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_2td.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(td_1 td_2 td_3 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_3td, replace)  ///
&gt;         saving(stphplot_trans_3td.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_3td.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(td_1 td_2 td_3 td_4 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_4td, replace)  ///
&gt;         saving(stphplot_trans_4td.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_4td.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_1td.gph&quot; &quot;${pathdata}\stphplot_trans_2td.gph&quot; &quot;${pathdata}\stphplot_trans_3td.gph&quot; &quot;${pathdata}\stphplot_trans_4td.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-TT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition (td_)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_trans_ph_ln_surv_time_td.png&quot;, as(png) replace width(2000) height(1000)
(file _trans_ph_ln_surv_time_td.png written in PNG format)

. graph export &quot;_trans_ph_ln_surv_time_td.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _trans_ph_ln_surv_time_td.pdf written in PDF format)

</code></pre>
<p><img src="_trans_ph_ln_surv_time_td.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      336.11
Log pseudolikelihood =   -82411.196             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362671   .0301261    14.00   0.000     1.304886    1.423015
              td_1 |   .8255772   .0236846    -6.68   0.000     .7804371    .8733281
              td_2 |    .818299   .0436349    -3.76   0.000     .7370936    .9084507
              td_3 |   .7989705   .0762864    -2.35   0.019     .6626089    .9633947
              td_4 |   .9470699   .1527693    -0.34   0.736     .6903622    1.299233
            _start |   1.000428   .0000419    10.20   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Modality&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_plan_res_td, replace)  ///
&gt;         saving(phtest_log_plan_res_td.gph, replace)
(file phtest_log_plan_res_td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      336.11
Log pseudolikelihood =   -82411.196             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362671   .0301261    14.00   0.000     1.304886    1.423015
              td_1 |   .8255772   .0236846    -6.68   0.000     .7804371    .8733281
              td_2 |    .818299   .0436349    -3.76   0.000     .7370936    .9084507
              td_3 |   .7989705   .0762864    -2.35   0.019     .6626089    .9633947
              td_4 |   .9470699   .1527693    -0.34   0.736     .6903622    1.299233
            _start |   1.000428   .0000419    10.20   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(td_1 ) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_1_td, replace)  ///
&gt;         saving(phtest_log_td_1_td.gph, replace)
(file phtest_log_td_1_td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_1_td.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      336.11
Log pseudolikelihood =   -82411.196             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362671   .0301261    14.00   0.000     1.304886    1.423015
              td_1 |   .8255772   .0236846    -6.68   0.000     .7804371    .8733281
              td_2 |    .818299   .0436349    -3.76   0.000     .7370936    .9084507
              td_3 |   .7989705   .0762864    -2.35   0.019     .6626089    .9633947
              td_4 |   .9470699   .1527693    -0.34   0.736     .6903622    1.299233
            _start |   1.000428   .0000419    10.20   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(td_2) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion (2nd)&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_2_td, replace)  ///
&gt;         saving(phtest_log_td_2_td.gph, replace)
(file phtest_log_td_2_td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_2_td.svg" width="800" ></p>
<pre><code>. qui estread &quot;${pathdata2}parmodels_m3_jun.sters&quot;

. xi: stcox i.tipo_de_plan_res_1 i.td_1 i.td_2 i.td_3 i.td_4 _start, efron robust nolog strata(_trans) tvc(i.tipo_de_plan_res_1 i.td_1 i.td_2)
i.tipo_de_pla~1   _Itipo_de_p_0-1     (naturally coded; _Itipo_de_p_0 omitted)
i.td_1            _Itd_1_0-1          (naturally coded; _Itd_1_0 omitted)
i.td_2            _Itd_2_0-1          (naturally coded; _Itd_2_0 omitted)
i.td_3            _Itd_3_0-1          (naturally coded; _Itd_3_0 omitted)
i.td_4            _Itd_4_0-1          (naturally coded; _Itd_4_0 omitted)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id


Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(9)     =      580.78
Log pseudolikelihood =   -82295.614             Prob &gt; chi2      =      0.0000

                                 (Std. Err. adjusted for 22,912 clusters in id)
-------------------------------------------------------------------------------
              |               Robust
           _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
main          |
_Itipo_de_p_1 |   1.780384   .0632098    16.25   0.000     1.660708    1.908685
     _Itd_1_1 |   .5524822   .0244624   -13.40   0.000     .5065583    .6025696
     _Itd_2_1 |   .4968014   .0537731    -6.46   0.000      .401837    .6142083
     _Itd_3_1 |   .8085681   .0768954    -2.23   0.025     .6710682    .9742411
     _Itd_4_1 |   .9411246   .1521859    -0.38   0.707      .685492    1.292087
       _start |   1.000418    .000042     9.96   0.000     1.000336    1.000501
--------------+----------------------------------------------------------------
tvc           |
_Itipo_de_p_1 |   .9997237   .0000285    -9.70   0.000     .9996679    .9997795
     _Itd_1_1 |   1.000483   .0000409    11.83   0.000     1.000403    1.000564
     _Itd_2_1 |   1.000376   .0000686     5.48   0.000     1.000241     1.00051
-------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwptt_td

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(appending m3_pwptt_td)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

</code></pre>
<h3><a href="#changed-how-covariates-were-coded-2" id="changed-how-covariates-were-coded-2">Changed how covariates were coded (2)</a></h3>
<pre><code>. ******************************************************************************
. gen TD = td_1

. 
. foreach num of numlist 1/4 {
  2. replace TD= td_`num' if _trans==`num'
  3. }
(0 real changes made)
(1,420 real changes made)
(395 real changes made)
(116 real changes made)

. 
. * similares a los TD.1 en stata que son transition specific covariates. 
. 
. cap noi drop sch* sca*

. stcox tipo_de_plan_res_1 TD _start , efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(3)     =      335.76
Log pseudolikelihood =   -82411.567             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362743   .0300973    14.01   0.000     1.305012    1.423028
                TD |   .8245898   .0197385    -8.06   0.000     .7867966    .8641985
            _start |   1.000428   .0000419    10.21   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.12588       157.76        1         0.0000
      TD          |      0.16199       224.23        1         0.0000
      _start      |      0.00584         0.24        1         0.6266
      ------------+---------------------------------------------------
      global test |                    353.26        3         0.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

</code></pre>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_1td2, replace)  ///
&gt;         saving(stphplot_trans_1td2.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_1td2.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_2td2, replace)  ///
&gt;         saving(stphplot_trans_2td2.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_2td2.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_3td2, replace)  ///
&gt;         saving(stphplot_trans_3td2.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_3td2.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_4td2, replace)  ///
&gt;         saving(stphplot_trans_4td2.gph, replace)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id
(file stphplot_trans_4td2.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_1td2.gph&quot; &quot;${pathdata}\stphplot_trans_2td2.gph&quot; &quot;${pathdata}\stphplot_trans_3td2.gph&quot; &quot;${pathdata}\stphplot_trans_4td2.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-TT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition (TD)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_trans_ph_ln_surv_time_td2.png&quot;, as(png) replace width(2000) height(1000)
(file _trans_ph_ln_surv_time_td2.png written in PNG format)

. graph export &quot;_trans_ph_ln_surv_time_td2.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _trans_ph_ln_surv_time_td2.pdf written in PDF format)

</code></pre>
<p><img src="_trans_ph_ln_surv_time_td2.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 TD _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(3)     =      335.76
Log pseudolikelihood =   -82411.567             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362743   .0300973    14.01   0.000     1.305012    1.423028
                TD |   .8245898   .0197385    -8.06   0.000     .7867966    .8641985
            _start |   1.000428   .0000419    10.21   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Modality&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_plan_res_td2, replace)  ///
&gt;         saving(phtest_log_plan_res_td2.gph, replace)
(file phtest_log_plan_res_td2.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_plan_res_td2.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 TD _start, efron robust nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(3)     =      335.76
Log pseudolikelihood =   -82411.567             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362743   .0300973    14.01   0.000     1.305012    1.423028
                TD |   .8245898   .0197385    -8.06   0.000     .7867966    .8641985
            _start |   1.000428   .0000419    10.21   0.000     1.000346     1.00051
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(TD) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_td2, replace)  ///
&gt;         saving(phtest_log_td_td2.gph, replace)
(file phtest_log_td_td2.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_td2.svg" width="800" ></p>
<pre><code>. qui estread &quot;${pathdata2}parmodels_m3_jun.sters&quot;

. xi: stcox i.tipo_de_plan_res_1 i.TD _start, efron robust nolog strata(_trans) tvc(i.tipo_de_plan_res_1 i.TD)
i.tipo_de_pla~1   _Itipo_de_p_0-1     (naturally coded; _Itipo_de_p_0 omitted)
i.TD              _ITD_0-1            (naturally coded; _ITD_0 omitted)

         failure _d:  _status
   analysis time _t:  _stop
  enter on or after:  time _start
  exit on or before:  time .
                 id:  id


Stratified Cox regr. -- Efron method for ties

No. of subjects      =       22,912             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(5)     =      586.09
Log pseudolikelihood =   -82298.821             Prob &gt; chi2      =      0.0000

                                 (Std. Err. adjusted for 22,912 clusters in id)
-------------------------------------------------------------------------------
              |               Robust
           _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
main          |
_Itipo_de_p_1 |   1.782501   .0633232    16.27   0.000     1.662612    1.911035
       _ITD_1 |   .5547387   .0219122   -14.92   0.000      .513412     .599392
       _start |   1.000419   .0000421     9.97   0.000     1.000337    1.000502
--------------+----------------------------------------------------------------
tvc           |
_Itipo_de_p_1 |   .9997272   .0000284    -9.60   0.000     .9996714    .9997829
       _ITD_1 |   1.000388   .0000298    13.02   0.000      1.00033    1.000446
-------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwptt_td2

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(appending m3_pwptt_td)
(appending m3_pwptt_td2)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

. 
</code></pre>
<p>=============================================================================</p>
<h2><a href="#pwp-gt" id="pwp-gt">PWP-GT</a></h2>
<p>=============================================================================</p>
<pre><code>. *In order to define time to each event from the time of the previous one, 
. *a gap time variable has to be generated, and initial times for all time spans are set to zero.
. use &quot;${pathdata2}five_st_msprep_jun.dta&quot;, clear 

. matrix mat_five_states = (.,1,.,.,. \ .,.,2,.,. \.,.,.,3,. \.,.,.,.,4 \.,.,.,.,.)

. msset, id(id) states(Readmission_status Readmission2_status Readmission3_status Readmission4_status) ///
&gt;                 times(Readmission_time Readmission2_time Readmission3_time Readmission4_time) transmatrix(mat_five_states)  //* saqué tipo_de_plan_res_1 para que no se empiece a subdividir

. gen time = _stop - _start

. gen time0=0

. *stset gap, fail(status) exit(time .) enter(time0)
. *https://www.stata.com/support/faqs/statistics/multiple-failure-time-data/#cond1
. stset time, fail(_status) exit(time .) enter(time0)

     failure event:  _status != 0 &amp; _status &lt; .
obs. time interval:  (0, time]
 enter on or after:  time time0
 exit on or before:  time .

------------------------------------------------------------------------------
     31,968  total observations
          0  exclusions
------------------------------------------------------------------------------
     31,968  observations remaining, representing
      9,261  failures in single-record/single-failure data
   44771646  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =     4,431

. 
. cap noi drop sch* sca*
variable sch* not found

. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4 _start, efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =        2,584             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(6)     =       43.25
Log pseudolikelihood =   -11797.699             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.136546     .05155     2.82   0.005      1.03987    1.242209
              TD_1 |   .8036512    .042024    -4.18   0.000     .7253659    .8903854
              TD_2 |   .8832747   .0500773    -2.19   0.029     .7903817    .9870855
              TD_3 |   .8173293   .0433569    -3.80   0.000     .7366197    .9068821
              TD_4 |    1.04975   .0586271     0.87   0.385     .9409087    1.171182
            _start |   1.000068    .000046     1.49   0.137     .9999782    1.000159
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.02640         1.51        1         0.2193
      TD_1        |      0.05802         5.95        1         0.0147
      TD_2        |      0.01828         0.68        1         0.4088
      TD_3        |      0.04883         4.53        1         0.0334
      TD_4        |      0.02378         1.19        1         0.2760
      _start      |      0.08099        12.74        1         0.0004
      ------------+---------------------------------------------------
      global test |                     35.09        6         0.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

. * cluster(id)
</code></pre>
<p>We checked the proportionality of hazards visually</p>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(TD_1 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_12, replace)  ///
&gt;         saving(stphplot_trans_12.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_12.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_22, replace)  ///
&gt;         saving(stphplot_trans_22.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_22.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_32, replace)  ///
&gt;         saving(stphplot_trans_32.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_32.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(TD_1 TD_2 TD_3 TD_4 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_42, replace)  ///
&gt;         saving(stphplot_trans_42.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_42.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_12.gph&quot; &quot;${pathdata}\stphplot_trans_22.gph&quot; &quot;${pathdata}\stphplot_trans_32.gph&quot; &quot;${pathdata}\stphplot_trans_42.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-GT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_trans_ph_ln_surv_time2.png&quot;, as(png) replace width(2000) height(1000)
(file _trans_ph_ln_surv_time2.png written in PNG format)

. graph export &quot;_trans_ph_ln_surv_time2.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _trans_ph_ln_surv_time2.pdf written in PDF format)

</code></pre>
<p><img src="_trans_ph_ln_surv_time2.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4 _start, efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =        2,584             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(6)     =       43.25
Log pseudolikelihood =   -11797.699             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.136546     .05155     2.82   0.005      1.03987    1.242209
              TD_1 |   .8036512    .042024    -4.18   0.000     .7253659    .8903854
              TD_2 |   .8832747   .0500773    -2.19   0.029     .7903817    .9870855
              TD_3 |   .8173293   .0433569    -3.80   0.000     .7366197    .9068821
              TD_4 |    1.04975   .0586271     0.87   0.385     .9409087    1.171182
            _start |   1.000068    .000046     1.49   0.137     .9999782    1.000159
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_TD_1_2, replace)  ///
&gt;         saving(phtest_log_TD_1_2.gph, replace)
(file phtest_log_TD_1_2.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_1_2.svg" width="800" ></p>
<pre><code>. qui estread &quot;${pathdata2}parmodels_m3_jun.sters&quot;

. stcox  tipo_de_plan_res_1 TD_1 TD_2 TD_3 TD_4 _start, efron robust nolog strata(_trans) cluster(id) tvc(TD_1 _start)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .


Stratified Cox regr. -- Efron method for ties

No. of subjects      =        2,584             Number of obs    =       2,584
No. of failures      =        2,143
Time at risk         =      1608281
                                                Wald chi2(8)     =       77.91
Log pseudolikelihood =   -11780.178             Prob &gt; chi2      =      0.0000

                                         (Std. Err. adjusted for 646 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
main               |
tipo_de_plan_res_1 |    1.14014   .0514963     2.90   0.004     1.043548    1.245673
              TD_1 |   .5980576   .0558368    -5.51   0.000     .4980487    .7181484
              TD_2 |    .890171   .0503969    -2.05   0.040     .7966779    .9946359
              TD_3 |   .8212318   .0435334    -3.72   0.000     .7401907    .9111458
              TD_4 |   1.062924   .0585244     1.11   0.268     .9541912    1.184048
            _start |   .9998162   .0000805    -2.28   0.023     .9996584    .9999741
-------------------+----------------------------------------------------------------
tvc                |
              TD_1 |   1.000504   .0001222     4.13   0.000     1.000265    1.000744
            _start |   1.000001   1.22e-07     4.54   0.000            1    1.000001
------------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwpgt

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(appending m3_pwptt_td)
(appending m3_pwptt_td2)
(appending m3_pwpgt)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

</code></pre>
<h3><a href="#changed-how-covariates-were-coded" id="changed-how-covariates-were-coded">changed how covariates were coded</a></h3>
<pre><code>. ******************************************************************************
. foreach num of numlist 1/4 {
  2. gen td_`num'=TD_`num'
  3. replace td_`num'=0 if _from&gt;`num'|_from&lt;`num'   
  4. }
(2,110 real changes made)
(16,514 missing values generated)
(18,482 real changes made)
(25,286 missing values generated)
(26,201 real changes made)
(29,384 missing values generated)
(29,732 real changes made)

. * similares a los TD.1 en stata que son transition specific covariates. 
. 
. cap noi drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      281.01
Log pseudolikelihood =   -83879.881             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |    1.36265   .0301639    13.98   0.000     1.304795    1.423072
              td_1 |    .825579   .0236843    -6.68   0.000     .7804396    .8733292
              td_2 |   .8152913   .0434398    -3.83   0.000     .7344456    .9050363
              td_3 |   .7847232   .0747777    -2.54   0.011     .6510344    .9458646
              td_4 |   .9274692   .1493809    -0.47   0.640     .6763983    1.271735
            _start |   .9998092   .0000329    -5.80   0.000     .9997447    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.08321        69.16        1         0.0000
      td_1        |      0.15600       211.70        1         0.0000
      td_2        |      0.06160        33.81        1         0.0000
      td_3        |      0.05114        22.01        1         0.0000
      td_4        |      0.04062        13.14        1         0.0003
      _start      |      0.06136        33.13        1         0.0000
      ------------+---------------------------------------------------
      global test |                    361.26        6         0.0000
      ----------------------------------------------------------------

note: robust variance-covariance matrix used.

</code></pre>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(td_1 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_12td, replace)  ///
&gt;         saving(stphplot_trans_12td.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_12td.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(td_1 td_2 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_22td, replace)  ///
&gt;         saving(stphplot_trans_22td.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_22td.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(td_1 td_2 td_3 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_32td, replace)  ///
&gt;         saving(stphplot_trans_32td.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_32td.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(td_1 td_2 td_3 td_4 _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_42td, replace)  ///
&gt;         saving(stphplot_trans_42td.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_42td.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_12td.gph&quot; &quot;${pathdata}\stphplot_trans_22td.gph&quot; &quot;${pathdata}\stphplot_trans_32td.gph&quot; &quot;${pathdata}\stphplot_trans_42td.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-GT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition (td_)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_trans_ph_ln_surv_time_2td.png&quot;, as(png) replace width(2000) height(1000)
(file _trans_ph_ln_surv_time_2td.png written in PNG format)

. graph export &quot;_trans_ph_ln_surv_time_2td.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _trans_ph_ln_surv_time_2td.pdf written in PDF format)

</code></pre>
<p><img src="_trans_ph_ln_surv_time_2td.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      281.01
Log pseudolikelihood =   -83879.881             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |    1.36265   .0301639    13.98   0.000     1.304795    1.423072
              td_1 |    .825579   .0236843    -6.68   0.000     .7804396    .8733292
              td_2 |   .8152913   .0434398    -3.83   0.000     .7344456    .9050363
              td_3 |   .7847232   .0747777    -2.54   0.011     .6510344    .9458646
              td_4 |   .9274692   .1493809    -0.47   0.640     .6763983    1.271735
            _start |   .9998092   .0000329    -5.80   0.000     .9997447    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Modality&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_plan_res_2td, replace)  ///
&gt;         saving(phtest_log_plan_res_2td.gph, replace)
(file phtest_log_plan_res_2td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_plan_res_2td.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      281.01
Log pseudolikelihood =   -83879.881             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |    1.36265   .0301639    13.98   0.000     1.304795    1.423072
              td_1 |    .825579   .0236843    -6.68   0.000     .7804396    .8733292
              td_2 |   .8152913   .0434398    -3.83   0.000     .7344456    .9050363
              td_3 |   .7847232   .0747777    -2.54   0.011     .6510344    .9458646
              td_4 |   .9274692   .1493809    -0.47   0.640     .6763983    1.271735
            _start |   .9998092   .0000329    -5.80   0.000     .9997447    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(td_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_1_2td, replace)  ///
&gt;         saving(phtest_log_td_1_2td.gph, replace)
(file phtest_log_td_1_2td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_1_2td.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      281.01
Log pseudolikelihood =   -83879.881             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |    1.36265   .0301639    13.98   0.000     1.304795    1.423072
              td_1 |    .825579   .0236843    -6.68   0.000     .7804396    .8733292
              td_2 |   .8152913   .0434398    -3.83   0.000     .7344456    .9050363
              td_3 |   .7847232   .0747777    -2.54   0.011     .6510344    .9458646
              td_4 |   .9274692   .1493809    -0.47   0.640     .6763983    1.271735
            _start |   .9998092   .0000329    -5.80   0.000     .9997447    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(td_2) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion (2nd)&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_2_2td, replace)  ///
&gt;         saving(phtest_log_td_2_2td.gph, replace)
(file phtest_log_td_2_2td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_2_2td.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      281.01
Log pseudolikelihood =   -83879.881             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |    1.36265   .0301639    13.98   0.000     1.304795    1.423072
              td_1 |    .825579   .0236843    -6.68   0.000     .7804396    .8733292
              td_2 |   .8152913   .0434398    -3.83   0.000     .7344456    .9050363
              td_3 |   .7847232   .0747777    -2.54   0.011     .6510344    .9458646
              td_4 |   .9274692   .1493809    -0.47   0.640     .6763983    1.271735
            _start |   .9998092   .0000329    -5.80   0.000     .9997447    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(td_3) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion (3rd)&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_3_2td, replace)  ///
&gt;         saving(phtest_log_td_3_2td.gph, replace)
(file phtest_log_td_3_2td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_3_2td.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 td_1 td_2 td_3 td_4 _start , efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      281.01
Log pseudolikelihood =   -83879.881             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |    1.36265   .0301639    13.98   0.000     1.304795    1.423072
              td_1 |    .825579   .0236843    -6.68   0.000     .7804396    .8733292
              td_2 |   .8152913   .0434398    -3.83   0.000     .7344456    .9050363
              td_3 |   .7847232   .0747777    -2.54   0.011     .6510344    .9458646
              td_4 |   .9274692   .1493809    -0.47   0.640     .6763983    1.271735
            _start |   .9998092   .0000329    -5.80   0.000     .9997447    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(td_4) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion (4th)&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_4_2td, replace)  ///
&gt;         saving(phtest_log_td_4_2td.gph, replace)
(file phtest_log_td_4_2td.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_4_2td.svg" width="800" ></p>
<pre><code>. qui estread &quot;${pathdata2}parmodels_m3_jun.sters&quot;

. xi: stcox i.tipo_de_plan_res_1 i.td_1 i.td_2 i.td_3 i.td_4 _start , efron nolog strata(_trans) cluster(id) tvc(i.tipo_de_plan_res_1 i.td_1 i.td_2 i.td_3 i.td_4 _start)
i.tipo_de_pla~1   _Itipo_de_p_0-1     (naturally coded; _Itipo_de_p_0 omitted)
i.td_1            _Itd_1_0-1          (naturally coded; _Itd_1_0 omitted)
i.td_2            _Itd_2_0-1          (naturally coded; _Itd_2_0 omitted)
i.td_3            _Itd_3_0-1          (naturally coded; _Itd_3_0 omitted)
i.td_4            _Itd_4_0-1          (naturally coded; _Itd_4_0 omitted)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .


Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(12)    =      533.72
Log pseudolikelihood =   -83755.338             Prob &gt; chi2      =      0.0000

                                 (Std. Err. adjusted for 22,912 clusters in id)
-------------------------------------------------------------------------------
              |               Robust
           _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
main          |
_Itipo_de_p_1 |   1.611767   .0550876    13.97   0.000     1.507335    1.723435
     _Itd_1_1 |   .5602297    .024831   -13.07   0.000     .5136158    .6110742
     _Itd_2_1 |   .5842624    .048092    -6.53   0.000     .4972141    .6865503
     _Itd_3_1 |   .3829423   .0642135    -5.72   0.000     .2756767    .5319449
     _Itd_4_1 |   .4495813   .1216374    -2.95   0.003     .2645511    .7640237
       _start |   .9995968   .0000527    -7.66   0.000     .9994936       .9997
--------------+----------------------------------------------------------------
tvc           |
_Itipo_de_p_1 |   .9997689   .0000347    -6.66   0.000     .9997008    .9998369
     _Itd_1_1 |   1.000477   .0000411    11.61   0.000     1.000397    1.000558
     _Itd_2_1 |   1.000487   .0000879     5.54   0.000     1.000315    1.000659
     _Itd_3_1 |   1.001071   .0001879     5.71   0.000     1.000703     1.00144
     _Itd_4_1 |    1.00121   .0003657     3.31   0.001     1.000494    1.001927
       _start |          1   7.77e-08     5.35   0.000            1    1.000001
-------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwpgt_td

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(appending m3_pwptt_td)
(appending m3_pwptt_td2)
(appending m3_pwpgt)
(appending m3_pwpgt_td)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

. 
</code></pre>
<h3><a href="#changed-how-covariates-were-coded-2" id="changed-how-covariates-were-coded-2">Changed how covariates were coded (2)</a></h3>
<pre><code>. ******************************************************************************
. gen TD = td_1

. 
. foreach num of numlist 1/4 {
  2. replace TD= td_`num' if _trans==`num'
  3. }
(0 real changes made)
(1,420 real changes made)
(395 real changes made)
(116 real changes made)

. 
. * similares a los TD.1 en stata que son transition specific covariates. 
. 
. cap noi drop sch* sca*

. stcox tipo_de_plan_res_1 TD _start , efron nolog strata(_trans) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects =       31,968                  Number of obs    =      31,968
No. of failures =        9,261
Time at risk    =     44771646
                                                LR chi2(3)       =      295.59
Log likelihood  =   -83880.249                  Prob &gt; chi2      =      0.0000

------------------------------------------------------------------------------------
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362891   .0292417    14.43   0.000     1.306767    1.421426
                TD |   .8226959   .0204223    -7.86   0.000     .7836271    .8637125
            _start |   .9998092   .0000333    -5.72   0.000     .9997439    .9998746
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. estat phtest, log detail

      Test of proportional-hazards assumption

      Time:  Log(t)
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob&gt;chi2
      ------------+---------------------------------------------------
      tipo_de_pl~1|     -0.08547        68.60        1         0.0000
      TD          |      0.17964       295.68        1         0.0000
      _start      |      0.05492        26.93        1         0.0000
      ------------+---------------------------------------------------
      global test |                    369.48        3         0.0000
      ----------------------------------------------------------------

</code></pre>
<pre><code>. stphplot if _trans==1, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: First transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_12td2, replace)  ///
&gt;         saving(stphplot_trans_12td2.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_12td2.gph saved)

.         
. stphplot if _trans==2, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Second transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_22td2, replace)  ///
&gt;         saving(stphplot_trans_22td2.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_22td2.gph saved)

.         
. stphplot if _trans==3, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Third transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_32td2, replace)  ///
&gt;         saving(stphplot_trans_32td2.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_32td2.gph saved)

.         
. stphplot if _trans==4, by(tipo_de_plan_res_1) adjust(TD _start) ///
&gt;  xtitle(&quot;Log Time (days)&quot;, size(small)) ///
&gt;         ylabel(-4(2)8, labsize(vsmall)) ///     
&gt;         legend(pos(7) ring(0) col(1) symysize(zero) keygap(1) symxsize(large) order( 1 2) lab(1 &quot;Outpatient&quot;) lab(2 &quot;Residential&quot;) size(small)) ///
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;by Treatment Modality at Baseline&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: Fourth transition}&quot;,size(small)) ///
&gt;         name(stphplot_trans_42td2, replace)  ///
&gt;         saving(stphplot_trans_42td2.gph, replace)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .
(file stphplot_trans_42td2.gph saved)

</code></pre>
<pre><code>. graph combine &quot;${pathdata}\stphplot_trans_12td2.gph&quot; &quot;${pathdata}\stphplot_trans_22td2.gph&quot; &quot;${pathdata}\stphplot_trans_32td2.gph&quot; &quot;${pathdata}\stphplot_trans_42td2.gph&quot;, ///
&gt; colfirst ycommon xcommon iscale(*.7) imargin(tiny) graphregion(color(gs16)) ///
&gt; title(&quot;Combination of −ln{−ln(survival)} vs. ln(analysis time)&quot; &quot;PWP-GT&quot;, size(medium)) cols(2) ///
&gt; subtitle(&quot;{it: in each transition (TD)}&quot;, size(small)) ///
&gt; note(&quot;{it:              Note: Ordered by columns, from up to down, left to right}&quot;, size(tiny))

. graph export &quot;_trans_ph_ln_surv_time_2td2.png&quot;, as(png) replace width(2000) height(1000)
(file _trans_ph_ln_surv_time_2td2.png written in PNG format)

. graph export &quot;_trans_ph_ln_surv_time_2td2.pdf&quot;, as(pdf) replace //*width(2000) height(2000) orientation(landscape)
(file _trans_ph_ln_surv_time_2td2.pdf written in PDF format)

</code></pre>
<p><img src="_trans_ph_ln_surv_time_2td2.svg" width="800" ></p>
<p>Explored schoenfeld residuals:</p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 TD _start, efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(3)     =      280.28
Log pseudolikelihood =   -83880.249             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362891   .0301417    14.00   0.000     1.305077    1.423267
                TD |   .8226959   .0196834    -8.16   0.000     .7850077    .8621934
            _start |   .9998092   .0000329    -5.80   0.000     .9997448    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. 
. estat phtest, log plot(tipo_de_plan_res_1) yline(0) msym(oh) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Modality&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_plan_res_2td2, replace)  ///
&gt;         saving(phtest_log_plan_res_2td2.gph, replace)
(file phtest_log_plan_res_2td2.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_plan_res_2td2.svg" width="800" ></p>
<pre><code>. drop sch* sca*

. stcox tipo_de_plan_res_1 TD _start, efron robust nolog strata(_trans) cluster(id) schoenfeld(sch*) scaledsch(sca*)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .

Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(3)     =      280.28
Log pseudolikelihood =   -83880.249             Prob &gt; chi2      =      0.0000

                                      (Std. Err. adjusted for 22,912 clusters in id)
------------------------------------------------------------------------------------
                   |               Robust
                _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
-------------------+----------------------------------------------------------------
tipo_de_plan_res_1 |   1.362891   .0301417    14.00   0.000     1.305077    1.423267
                TD |   .8226959   .0196834    -8.16   0.000     .7850077    .8621934
            _start |   .9998092   .0000329    -5.80   0.000     .9997448    .9998736
------------------------------------------------------------------------------------
                                                          Stratified by _trans

. 
. estat phtest, log plot(TD) yline(0) msym(oh) msize(tiny) ///
&gt;          xtitle(&quot;Time (days)&quot;, size(small)) ///
&gt;         xlabel(0(1460)5000, labsize(vsmall)) ///        
&gt;         ylabel(-4(1)4, labsize(vsmall)) ///     
&gt;         ytitle(&quot;Schoenfeld residuals&quot;, size(small)) scheme(sj) graphregion(color(white)) ///
&gt;         note(&quot;{it:Note. Means and 95% CI's; Bandwidth=.8; Natural log of analysis time used.}&quot;,size(vsmall)) ///
&gt;         title(&quot;Plot of scaled Schoenfeld residuals versus&quot; &quot;time produced for the covariate Treatment Completion&quot;, size(medium)) ///
&gt;         subtitle(&quot;{it: specified by Running mean smoother}&quot;,size(small)) ///
&gt;         name(phtest_log_td_2td2, replace)  ///
&gt;         saving(phtest_log_td_2td2.gph, replace)
(file phtest_log_td_2td2.gph saved)

. ***The stphtest command with the plot option will provide the graphs with a lowess curve.  
. ***The usual graphing options can be used to include a horizontal reference line at y=0. 
</code></pre>
<p><img src="phtest_log_td_2td2.svg" width="800" ></p>
<pre><code>. qui estread &quot;${pathdata2}parmodels_m3_jun.sters&quot;

. xi: stcox i.tipo_de_plan_res_1 i.TD _start, efron robust nolog strata(_trans) cluster(id) tvc(i.tipo_de_plan_res_1 i.TD _start)
i.tipo_de_pla~1   _Itipo_de_p_0-1     (naturally coded; _Itipo_de_p_0 omitted)
i.TD              _ITD_0-1            (naturally coded; _ITD_0 omitted)

         failure _d:  _status
   analysis time _t:  time
  enter on or after:  time time0
  exit on or before:  time .


Stratified Cox regr. -- Efron method for ties

No. of subjects      =       31,968             Number of obs    =      31,968
No. of failures      =        9,261
Time at risk         =     44771646
                                                Wald chi2(6)     =      518.39
Log pseudolikelihood =   -83762.882             Prob &gt; chi2      =      0.0000

                                 (Std. Err. adjusted for 22,912 clusters in id)
-------------------------------------------------------------------------------
              |               Robust
           _t | Haz. Ratio   Std. Err.      z    P&gt;|z|     [95% Conf. Interval]
--------------+----------------------------------------------------------------
main          |
_Itipo_de_p_1 |   1.612685   .0550757    13.99   0.000     1.508272    1.724326
       _ITD_1 |   .5577293   .0207699   -15.68   0.000     .5184712    .5999599
       _start |    .999594   .0000526    -7.72   0.000      .999491    .9996971
--------------+----------------------------------------------------------------
tvc           |
_Itipo_de_p_1 |   .9997666   .0000346    -6.74   0.000     .9996987    .9998344
       _ITD_1 |   1.000503   .0000363    13.87   0.000     1.000432    1.000574
       _start |          1   7.73e-08     5.44   0.000            1    1.000001
-------------------------------------------------------------------------------
                                                          Stratified by _trans
Note: Variables in tvc equation interacted with _t.

. estimates store m3_pwpgt_td2

. estwrite _all using &quot;${pathdata2}parmodels_m3_jun.sters&quot;, append
(appending m3_pwptt)
(appending m3_pwptt_td)
(appending m3_pwptt_td2)
(appending m3_pwpgt)
(appending m3_pwpgt_td)
(appending m3_pwpgt_td2)
(file C:/Users/CISS Fondecyt/Mi unidad/Alvacast/SISTRAT 2019 (github)/_mult_state_ags/parmodels_m3_jun.sters saved)

. 
</code></pre>
<h2><a href="#">=============================================================================</a></h2>
<h2><a href="#">=============================================================================</a></h2>
<p>Saved at= 16:01:25 12 Aug 2021</p>
